%! TEX root = thesis.tex
% vim: ft=tex et sts=2 sw=2

\chapter{Thermal fluctuations of frameworks}
\label{chap03}

\chapterprecishere{%
In this chapter we study the effects that thermal fluctuations have on bar-joint frameworks at the submicron scale.
In particular, we study the free-energy landscape of these frameworks, and show that the landscape is dominated by the neighborhoods of points that correspond to singularities in the framework's shape space.
\\
}

Energy landscapes have been extensively used in all branches of science and engineering to provide an intuitive understanding of complex dynamical phenomena.
They have been crucial in understanding a host of problems in chemical kinetics, protein folding, optimization, machine learning, etc.~\cite{wales2018}.
However, the energy $U(\bm{r})$ of a physical system is usually a scalar function of a possibly high-dimensional configuration vector $\bm{r}$ describing the system.
This curse of dimensionality oftentimes makes it difficult to visualize energy landscapes directly.
For this reason, particularly in the case of physical systems coupled to a heat bath, it is much more customary to consider the free-energy landscape obtained by projecting the free energy of the system down to a small number of physically relevant coordinates.
Below, we provide a brief description of free-energy landscapes in a general setting.

\section{Free-energy landscapes}

Similar to the discussion in the previous chapter, consider a system of $N$ classical particles in $d$ dimensions.
Let the position of the $i$th particle be $\bm{r}_{i} \in \mathbb{R}^{d}$.
We can then use a configuration vector $\bm{r} \in \mathscr{R} \subseteq \mathbb{R}^{Nd}$ defined by $\bm{r} = (\bm{r}_{1}, \bm{r}_{2}, \ldots, \bm{r}_{N})$ to describe all configurations of the system.
Corresponding to $\bm{r}$ we define a momentum vector $\bm{p} = (\bm{p}_{1}, \bm{p}_{2}, \ldots, \bm{p}_{N})$, where $\bm{p}_{i}$ is the momentum of the $i$th particle.
The microscopic state of the system at a given moment is then described by the position-momentum pair $(\bm{r}, \bm{p})$ in phase space.
Additionally, let the total energy of the system be given by the Hamiltonian
%
\begin{equation}
  H(\bm{r}, \bm{p}) = E_{\text{kinetic}}(\bm{p}) + U(\bm{q}) = \sum_{i=1}^{N} \frac{\bm{p}^{2}_{i}}{2 m_{i}} + U(\bm{q}).
\end{equation}
%
Here we have assumed that the Hamiltonian $H$ is separable, i.e., the energetic contributions of the particle momenta and positions are independent.

Physical systems that have been equilibrated with a thermal bath of temperature $T$ frequently arise in statistical physics.
Although the energy of a such a system undergoes fluctuations, the system itself is always at a fixed temperature.
Then, the various microscopic configurations of the systems, i.e., $(\bm{r}, \bm{p})$ pairs, are distributed according to the Boltzmann--Gibbs (or canonical) density
%
\begin{equation}
  \mathscr{P}(\bm{r}, \bm{p}) = Z^{-1}\exp\left[-\beta H(\bm{r}, \bm{p})\right]
\end{equation}
%
where $\beta = (k_{B}T)^{-1}$ is the inverse temperature, with $k_{B}$ being the Boltzmann constant.
Also, the normalization factor $Z$ is the partition function defined by $Z = \int \dd{\bm{r}}\,\dd{\bm{p}}\, \exp\left[-\beta H(\bm{r}, \bm{p})\right]$.
When the Hamiltonian $H$ is separable, we can perform the momentum integrals independently so that the effective, momentum-reduced probability density is
%
\begin{equation}
  \mathscr{P}(\bm{r}) = \exp\left[-\beta U(\bm{q})\right].
\end{equation}
%
Above, we have purposefully omitted factors of normalization---something we will continue to do as much as possible.

As we remarked earlier, most physical systems, even those with a handful of particles, suffer from the curse of dimensionality.
High-dimensional systems that are coupled to a heat bath are better analyzed by considering the marginal probability density of a lower-dimensional \ac{cv}, which is some physically relevant observable that (hopefully) tells us something useful about the system.
Let $\xi \in \mathbb{R}^{l}$ with $l \geq 1$ be such an observable that depends only on particle positions and measurable by a sufficiently smooth map $\hat{\xi}: \mathbb{R}^{n} \to \mathbb{R}^{l}$.
The marginal probability density $\mathscr{P}(\xi)$ of the \ac{cv} $\xi$ is defined as
%
\begin{equation}
  \mathscr{P}(\xi) = \int \dd{\bm{r}}\, \delta\left[\hat{\xi}(\bm{r}) - \xi\right]\,\exp\left[-\beta U(\bm{q})\right].
  \label{c03:eq:probtrans}
\end{equation}
%
Here $\delta[\cdot]$ is the $l$-dimensional Dirac delta function, which restricts the domain of integration to the $(n-l)$-dimensional \ac{cv} level set $\hat{\xi}^{-1}(\xi) = \left\{\bm{q} \in \mathbb{R}^{n}: \hat{\xi}(\bm{q}) = \xi\right\}$~\cite{hartmann2011}.
The usage of the term ``collective variable'' is now clear: the marginal density $\mathscr{P}(\xi)$ no longer refers to a single microstate---instead, it refers to a collection of a large number of microstates such that if we were to measure the value of the \ac{cv} using any one of the states, we would get $\xi$.

To show that Eq.~\eqref{c03:eq:probtrans} gives the correct marginal density, we first note that the average $\braket{\phi}$ of an observable $\phi \equiv \phi(\xi) = \phi[\hat{\xi}(\bm{r})]$ that depends only on the \ac{cv} $\xi$ can be computed using either the marginal density $\mathscr{P}(\xi)$ or the Boltzmann--Gibbs density $\mathscr{P}(\bm{r})$, i.e.,
%
\begin{equation}
  \braket{\phi} = \int \dd{\xi'}\, \phi(\xi')\,\mathscr{P}(\xi') = \int \dd{\bm{r}}\, \phi[\hat{\xi}(\bm{r})]\,\mathscr{P}(\bm{r}).
\end{equation}
%
Setting $\phi(\xi') = \delta(\xi' - \xi)$ yields
%
\begin{equation}
  \int \dd{\xi'}\, \delta(\xi' - \xi) \mathscr{P}(\xi') = \mathscr{P}(\xi) = \int \dd{\bm{r}}\, \delta[\hat{\xi}(\bm{r}) - \xi] \mathscr{P}(\bm{r}),
\end{equation}
%
consistent with the definition in Eq.~\eqref{c03:eq:probtrans}.

The thermodynamic free energy associated with the \ac{cv} $\xi$ is defined using the marginal density $\mathscr{P}(\xi)$ as~\cite{lelievre2010}
%
\begin{equation}
  \mathscr{A}(\xi) = -\beta^{-1}\log{\mathscr{P}(\xi)}.
  \label{eq:free_energy}
\end{equation}
%
With this definition, we see that the free energy $\mathscr{A}(\xi)$ has an ``inverse'' relationship with $\mathscr{P}(\xi)$, i.e., a low value of $\mathscr{A}(\xi)$ indicates a higher probability of observing states with a \ac{cv} value of $\xi$, and vice versa.
Also, because of the arbitrariness of normalization factors, it makes better sense to speak of free energy differences rather than absolute free energies, e.g., the free-energy difference between two \ac{cv} values $\xi_{1}$ and $\xi_{2}$ is $\Delta \mathscr{A} = \mathscr{A}(\xi_{2}) - \mathscr{A}(\xi_{1})$.

\section{Free energy of frameworks}

Recall that the total elastic energy of a framework is of the form $U(\bm{r}) = \sum_{i=1}^{m} \phi_{i}(\ell_{i})$, where $\ell_{i}$ is the length of the $i$th bar with an energy $\phi_i(\ell_{i})$, which is assumed to have a minimum value of zero at $\ell_{i} = \bar{\ell_{i}}$, the natural length of the $i$th bar.
%
With the above form of the energy, all nontrivial ground states of a framework belong to its shape space $\Sigma$~\cite{kendall1989,mezey1993,kendall1999}, which is the set of all deformed configurations of the framework with the length of each bar equal to its natural length, once rotations and translations are removed.
We remarked earlier that the shape space of the framework are parameterized by coordinates called shape coordinates~\cite{littlejohn1995}---usually internal angles---that capture the framework's shape changes (see the discussion in Section~\ref{sec:frameworks}).
As zero-energy shape changes constitute the most interesting dynamical feature of a framework, it follows that the shape coordinates are natural \ac{cv}s for a low-dimensional description of a thermally excited framework.

Let us assume that the value of the chosen \ac{cv}/shape coordinate for any configuration $\bm{q} \in \mathbb{R}^{n}$ of the framework in its body frame can be measured using the \ac{cv} map $\hat{\xi}(\bm{q})$.
In the case of the four-bar linkage, for example, if we choose $\theta_{1}$ as the \ac{cv}, then $\hat{\xi}(\bm{q)}$ is the map that computes $\theta_{1}$ for any $\bm{q}$, whether or not it lies on the branches of the linkage's shape space (see Fig.~\ref{fig:4bar_cs} on p.~\pageref{page:4bar}).
For frameworks, the marginal density $\mathscr{P}(\xi)$ of the \ac{cv}, aside from factors of normalization, is
%
\begin{equation}
  \mathscr{P}(\xi) = \int_{\mathbb{R}^{n}} \dd\bm{q}\, I(\bm{q})\, \delta\left[\hat{\xi}(\bm{q}) - \xi\right] \exp\left[-\beta U(\bm{q})\right].
  \label{eq:mpd}
\end{equation}
%
In the above equation, except for the Jacobian factor $I(\bm{q})$ introduced by the change of coordinates from the lab frame to the body frame, all the other terms have the same meaning as in Eq.~\eqref{c03:eq:probtrans}.
Also, as the \ac{cv} $\xi$ is an $(n-m)$-dimensional shape coordinate, the \ac{cv} map is $\hat{\xi}: \mathbb{R}^{n} \to \mathbb{R}^{n-m}$.
Furthermore, the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$ will be an $m$-dimensional manifold if $\nabla\hat{\xi}$ has full rank in $\hat{\xi}^{-1}(\xi)$.
Assuming this, the marginal density $\mathscr{P}(\xi)$ can be written as an exact $m$-dimensional surface integral over $\hat{\xi}^{-1}(\xi)$ using the coarea formula~\cite{hartmann2007,lelievre2010,hartmann2011,diaconis2013},
%
\begin{equation}
  \mathscr{P}(\xi) = \int_{\hat{\xi}^{-1}(\xi)} \frac{\dd\Theta(\bm{q})}{\abs{\det\,\nabla\hat{\xi}(\nabla\hat{\xi})\trans}^{1/2}} I(\bm{q}) \exp{\left[-\beta U(\bm{q})\right]}.
  \label{eq:coarea}
\end{equation}
%
Here $\dd\Theta(\bm{q})$ is the surface measure on $\hat{\xi}^{-1}(\xi)$ and $\nabla\hat{\xi}$ is the $(n-m)\times n$ Jacobian matrix of $\hat{\xi}$ at $\bm{q}$.
Sometimes, Eq.~\eqref{eq:coarea} is taken to be the definition of $\mathscr{P}(\xi)$ instead of Eq.~\eqref{eq:mpd}.
This only makes sense when $\nabla\hat{\xi}$ has full rank in $\hat{\xi}^{-1}(\xi)$ so that the determinant $\det\,\nabla\hat{\xi}(\nabla\hat{\xi})\trans$ does not vanish~\cite{lelievre2010}.%
\footnote{Equation~\eqref{eq:coarea} is the arbitrary-dimensional analogue of the RHS in $\int_{\mathbb{R}} \dd{x}\, f(x)\, \delta[g(x)] = \sum_{i} f(x_{i})/\abs{g'(x_{i})}$, where $f$ and $g$ are scalar functions in $\mathbb{R}$, and $x_{i}$ are the roots of $g(x) = 0$. This is assuming $\abs{g'(x_{i})} \neq 0$, which is equivalent to the assumption that $\nabla\hat{\xi}$ has full rank in $\hat{\xi}^{-1}(\xi)$.}
Furthermore, although we have in mind an $(n-m)$-dimensional \ac{cv} $\xi$ that can be used to parameterize the branches of the shape space $\Sigma$, we do not require a parameterization at hand to use Eq.~\eqref{eq:coarea}.
For instance, in a framework the \ac{cv} could be one of its internal angles, whose value can be directly computed from the coordinates of the framework's joints.
(The map that turns the coordinates $\bm{q}$ into the internal angle is the \ac{cv} map $\hat{\xi}(\bm{q})$ for the framework.)
Hence, in theory, using this equation only requires knowledge of the energy $U(\bm{q})$, the Jacobian factor $I(\bm{q})$, and the \ac{cv} map $\hat{\xi}$.
Most importantly, Eq.~\eqref{eq:coarea} makes no reference to the shape space $\Sigma$, or its branches, or whether or not it has singularities.
However, in general, the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$ is bound to be a curved high-dimensional manifold.
Hence, directly evaluating the integral in Eq.~\eqref{eq:coarea} becomes cumbersome, and we have to resort to asymptotic methods to evaluate it.

It is clear from both Eqs.~\eqref{eq:mpd} and \eqref{eq:coarea} that in the large-$\beta$ limit, contributions to the marginal density would mainly come from the neighborhoods of the ground states in the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$ since the energy $U(\bm{q})$ vanishes at those points (see Fig.~\ref{fig:levelsets}).
Since all ground states belong to the shape space $\Sigma$, they could be regular (i.e., nonsingular) points or singularities of $\Sigma$.
We call $\xi$ a regular value of the \ac{cv} if $\hat{\xi}^{-1}(\xi)$ does not contain singularities of $\Sigma$ and vice-versa.
After asymptotically evaluating the integral in Eq.~\eqref{eq:mpd} in the neighborhood of each ground state (e.g., using Laplace's method~\cite{breitung1994}), we can then sum the results to find the asymptotic expression of the marginal density.
In the following, to simplify the presentation, we will only consider cases where the \ac{cv} level set contains just one ground state, which is either a regular point or a singularity of $\Sigma$.
More general cases can then be handled by using appropriate combinations of the results we derive.

\subsection{Asymptotic marginal density: regular values}
\label{sec:regular}

We first consider the case where $\xi$ is a regular value of the \ac{cv}, i.e., when the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$ contains only regular points of $\Sigma$.
As we remarked previously, using Eq.~\eqref{eq:coarea} to find the marginal density is difficult.
Hence, we will use a Gaussian representation of the delta function to write the marginal density as~\cite{hartmann2007a,hartmann2011}
%
\begin{equation}
  \mathscr{P}(\xi) = \lim_{\alpha\to\infty} \left(\frac{\alpha}{2\pi}\right)^{(n-m)/2} \int_{\mathbb{R}^n} \dd \bm{q}\, I(\bm{q}) \exp{\left[-\tfrac{1}{2}\alpha\Abs{\hat{\xi}(\bm{q}) - \xi}^2 - \beta U(\bm{q})\right]},
  \label{eq:prob_delta}
\end{equation}
%
where $\Abs{\cdot}$ is the $(n-m)$-dimensional Euclidean norm.
For $\bm{q} \in \hat{\xi}^{-1}(\xi)$, the norm $\Abs{\hat{\xi}(\bm{q}) - \xi}$ vanishes.
Similarly, for $\bm{q} \in \Sigma$, the energy $U(\bm{q})$ vanishes.
This means that in the limit $\alpha, \beta \to \infty$, contributions to the above integral would mainly come from the neighborhood of the ground state $\bar{\bm{q}} = \Sigma \cap \hat{\xi}^{-1}(\xi)$.
Hence, we can evaluate the above integral using Laplace's method after expanding the two terms in the exponent of Eq.~\eqref{eq:prob_delta} to the lowest order around $\bar{\bm{q}}$.
To this end, we set $\bm{q} \to \bar{\bm{q}} + \bm{q}$, and expand the energy $U(\bm{q})$ using the harmonic approximation: $U \approx \tfrac{1}{2}\bm{q}\trans \mathsf{D}\bm{q}$ [see Eq.~\eqref{eq:regenergy}], where $\mathsf{D}$ is the $n\times n$ dynamical matrix.
Since $\bar{\bm{q}}$ is a regular point of $\Sigma$, the compatibility matrix $\mathsf{C}$ has full rank, and $\mathsf{D}$ has $n-m$ independent zero modes that belong to $\ker\mathsf{C}$~\cite{lubensky2015}.
These zero modes are all tangent to $\Sigma$ and represent a degree of freedom~\cite{leimkuhler2005}.
Hence, to asymptotically evaluate Eq.~\eqref{eq:mpd} in the neighborhood of a regular point, we can safely use the harmonic approximation since any divergence~\cite{schwarz1979,ellis1981,rocklin2018} due to these zero modes is regularized by the delta function [or in the case of Eq.~\eqref{eq:prob_delta}, its Gaussian approximation], which suppresses all contributions to the integral that are tangent to $\Sigma$~\cite{ramond1997}.
This gives us
%
\begin{equation}
  \mathscr{P}(\xi) \sim \lim_{\alpha\to\infty} \frac{\alpha^{-m/2}}{(2\pi)^{(n-m)/2}}I(\bar{\bm{q}})\int_{\mathbb{R}^n} \dd{\bm{q}}\, \exp\left\{-\tfrac{1}{2}\bm{q}\trans\left[(\nabla\hat{\xi})\trans\nabla\hat{\xi} + \alpha^{-1}\beta \mathsf{D}\right]\bm{q}\right\},
  \label{eq:prob_gaussian}
\end{equation}
%
where the dynamical matrix $\mathsf{D}$ and the Jacobian matrix $\nabla\hat{\xi}$ are evaluated at $\bar{\bm{q}}$.
We have also rescaled $\bm{q} \to \alpha^{-1/2}\bm{q}$ for convenience.
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/levelsets}
  \end{center}
  \caption{Cartoon illustrating the shape space $\Sigma$ parameterized by the \ac{cv} $\xi$ and the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$.
    In general, the sets $\Sigma$ and $\hat{\xi}^{-1}(\xi)$ could intersect at multiple points, each of which is an energy ground state.
    Tangent and normal spaces of $\Sigma$ at such a point $\bar{\bm{q}} \in \Sigma \cap \hat{\xi}^{-1}(\xi)$ are $T_{\bar{\bm{q}}}\Sigma$ and $N_{\bar{\bm{q}}}\Sigma$.}
  \label{fig:levelsets}
\end{figure}

We shall now evaluate the Gaussian integral in Eq.~\eqref{eq:prob_gaussian}.
Let us assume that the local parameterization of $\Sigma$ near $\bar{\bm{q}}$ in terms of the \ac{cv} is $\psi: \mathbb{R}^{n-m} \to \mathbb{R}^n$, which means that $\bar{\bm{q}} = \psi(\xi)$.
Now, the zero modes at $\bar{\bm{q}}$ belong to the tangent space $T_{\bar{\bm{q}}}\Sigma = \ker \mathsf{C}$ by definition~\cite{leimkuhler2005}.
This implies that the normal modes of the dynamical matrix, which are orthogonal to the zero modes, belong to the $m$-dimensional normal space $N_{\bar{\bm{q}}}\Sigma = (\ker\mathsf{C})^\perp$.
Since $T_{\bar{\bm{q}}}\Sigma \oplus N_{\bar{\bm{q}}}\Sigma = \mathbb{R}^n$, we can always write $\bm{q} = \bm{u} + \bm{v}$ with
$\bm{\bm{u}} \in T_{\bar{\bm{q}}}\Sigma$ and $\bm{v} \in N_{\bar{\bm{q}}}\Sigma$, for any $\bm{q} \in \mathbb{R}^n$ (see Fig.~\ref{fig:levelsets}).
As an orthonormal basis for $N_{\bar{\bm{q}}}\Sigma$, choose the normal modes $\bm{b}_1, \bm{b}_2, \ldots, \bm{b}_m \in \mathbb{R}^n$ and as the basis for $T_{\bar{\bm{q}}}\Sigma$ choose the columns of the $n\times(n-m)$ Jacobian matrix $\nabla\psi(\xi)$.%
\footnote{The normal modes need not be orthonormal if there is degeneracy in the normal frequencies.
But in such a situation, one can still pick a set of orthonormal vectors within the subspace spanned by degenerate normal modes.
With some extra steps, the derivation can also be made to work for an arbitrary basis of $N_{\bar{\bm{q}}}\Sigma$ as well.}
Therefore, we can write
%
\begin{equation}
  \bm{q} = \bm{u} + \bm{v} = (\nabla\psi)\bm{x} + \mathsf{B}\bm{y},
  \label{eq:coord_change}
\end{equation}
%
where $\mathsf{B}  = \inmat{\bm{b}_1 & \bm{b}_2 & \cdots & \bm{b}_m}$ is the change-of-basis matrix for $N_{\bar{\bm{q}}}\Sigma$.
The vectors $\bm{x} \in \mathbb{R}^{n-m}$ and $\bm{y} \in \mathbb{R}^m$ represent the components of $\bm{u}$ and $\bm{v}$ in the chosen bases.
Eq.~\eqref{eq:coord_change} suggests the coordinate change $\bm{q} \to (\bm{x}, \bm{y})$.
The quadratic form in the integral of Eq.~\eqref{eq:prob_gaussian} after such a coordinate change can be decomposed into blocks as
%
\begin{equation}
  \tfrac{1}{2}
  \begin{pmatrix}
    \bm{x}\trans & \bm{y}\trans
  \end{pmatrix}
  \begin{pmatrix}
    (\nabla\psi)\trans(\nabla\hat{\xi})\trans\nabla{\hat{\xi}}\nabla\psi &
    \quad(\nabla\psi)\trans(\nabla\hat{\xi})\trans\nabla\hat{\xi}\mathsf{B} \\
    \mathsf{B}\trans(\nabla\hat{\xi})\trans\nabla{\hat{\xi}}\nabla\psi &
    \quad\mathsf{B}\trans(\nabla\hat{\xi})\trans\nabla\hat{\xi}\mathsf{B} + \alpha^{-1}\beta\mathsf{D}^\perp &
  \end{pmatrix}
  \begin{pmatrix}
    \bm{x}\\
    \bm{y}
  \end{pmatrix},
  \label{eq:quadratic_form}
\end{equation}
%
where $\mathsf{D}^\perp$ is the diagonal matrix of the $m$ nonzero eigenvalues of $\mathsf{D}$.
Our assumption is that $\psi(\xi)$ is a valid parameterization of $\Sigma$ that is compatible with the \ac{cv} map $\hat{\xi}$, i.e., $\bar{\bm{q}} = \psi(\xi)$ and $\hat{\xi}(\bar{\bm{q}}) = \xi$, which means that
%
\begin{equation}
  (\hat{\xi}\circ\psi)(\xi) = \xi.
\end{equation}
%
Taking derivatives with respect to $\xi$ on both sides of the above equation we see that
%
\begin{equation}
  \nabla\hat{\xi}(\bar{\bm{q}})\nabla\psi(\xi) = \mathsf{I}_{n-m},
  \label{eq:cv_map_well_behaved}
\end{equation}
%
where $\mathsf{I}_{n-m}$ is the $(n-m)\times(n-m)$ identity matrix.
Using this, the $n\times n$ block matrix in Eq.~\eqref{eq:quadratic_form} can be written as
%
\begin{equation}
  \begin{pmatrix}
    \mathsf{I}_{n-m} &
    \quad\nabla\hat{\xi}\mathsf{B}\\
    \mathsf{B}\trans(\nabla\hat{\xi})\trans &
    \quad\mathsf{B}\trans(\nabla\hat{\xi})\trans\nabla\hat{\xi}\mathsf{B} + \alpha^{-1}\beta\mathsf{D}^\perp
  \end{pmatrix}.
\end{equation}
%
Since $\mathsf{I}_{n-m}$ is trivially invertible, the determinant of the above matrix is
%
\begin{equation}
  \det\,\mathsf{I}_{n-m}\det\,\big[\mathsf{B} \trans(\nabla\hat{\xi})\trans\nabla\hat{\xi}\mathsf{B}  + \alpha^{-1}\beta\mathsf{D}^\perp - \mathsf{B}\trans(\nabla\hat{\xi})\trans\mathsf{I}^{-1}_{n-m}\nabla\hat{\xi}\mathsf{B}\big]
  =
  \alpha^{-m}\beta^m \det\,\mathsf{D}^\perp.
  \label{eq:determinant}
\end{equation}

Under the coordinate change $\bm{q} \to (\bm{x},\bm{y})$, the volume element $\dd{\bm{q}}$ in the integral in Eq.~\eqref{eq:prob_gaussian} acquires the factor $\sqrt{\abs{\det\,\mathsf{J}\trans\mathsf{J}}}$, where $\mathsf{J}$ is the Jacobian of the transformation.
The matrix $\mathsf{J}\trans\mathsf{J}$ can be readily cast into blocks as
%
\begin{equation}
  \mathsf{J}\trans\mathsf{J} =
  \begin{pmatrix}
    (\nabla\psi)\trans\nabla\psi & 0 \\
    0 & \mathsf{B}\trans\mathsf{B}
  \end{pmatrix}
  =
  \begin{pmatrix}
    (\nabla\psi)\trans\nabla\psi & 0 \\
    0 & \mathsf{I}_{m}
  \end{pmatrix}.
\end{equation}
%
Here $(\nabla\psi)\trans\nabla\psi$ is the metric induced by the embedding $\xi \mapsto \psi(\xi)$ and since the normal modes are orthonormal vectors, $\mathsf{B} \trans\mathsf{B}  = \mathsf{I}_m$.
Also, the off-diagonal blocks vanish since they involve inner products of the basis vectors of $T_{\bar{\bm{q}}}\Sigma$ and $N_{\bar{\bm{q}}}\Sigma$, which are orthogonal complements of each other.
This gives $\sqrt{\abs{\det\,\mathsf{J}\trans\mathsf{J}}} = \sqrt{\smash[b]{\abs{\det\, (\nabla\psi)\trans\nabla\psi}}}$, which together with Eq.~\eqref{eq:determinant} lets us evaluate the Gaussian integral in Eq.~\eqref{eq:prob_gaussian} and write
%
\begin{equation}
  \mathscr{P}(\xi) \sim I(\xi)\left(\frac{2\pi}{\beta}\right)^{m/2}
  \left|\frac{\det\,[\nabla\psi(\xi)]\trans\nabla\psi(\xi)}{\det\,\mathsf{D}^{\perp}(\xi)}\right|^{1/2}.
  \label{eq:mpd_regular}
\end{equation}
%
The form of the above equation suggests that the nonzero eigenvalues of $\mathsf{D}$ can be naturally interpreted as being inversely proportional to the effective widths of the fluctuations along the $m$ dimensions perpendicular to $\Sigma$.
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/intersect.pdf}
  \end{center}
  \caption{Cartoon illustrating the geometry of the branches and the level set $(\nabla\hat{\xi})^{-1}(\xi - \xi^{*})$ of the linearized \ac{cv} map near the singularity, which is at $\bar{\bm{q}}^{*}$.
    The two ground-state configurations in the \ac{cv} level set are indicated by the intersection points of the branches with $(\nabla\hat{\xi})^{-1}(\xi - \xi^{*})$.  As $\xi \to \xi^{*}$, these ground states get infinitesimally close to each other and the framework becomes soft.
    The vector $\bm{u} \in \ker\mathsf{C}$ and the vector $\bm{v} \in (\ker\mathsf{C})^{\perp}$.
    Also indicated is a tangent vector $\bm{t}$ to a branch at the singularity.
    Here there is only one state of self stress and the delta function restricts the integral in Eq.~\eqref{eq:mpd_singular} to the line $\Xi_{\xi}$ formed by the intersection of $(\nabla\hat{\xi})^{-1}(\xi - \xi^{*})$ and $\ker\mathsf{C}$.
  }
  \label{fig:intersect}
\end{figure}

\subsection{Asymptotic marginal density: singular values}
\label{sec:singular}

Equation~\eqref{eq:mpd_regular} breaks down as we approach a singularity along $\Sigma$ since the lowest $s$ nonzero eigenvalues of $\mathsf{D}$ become very small and tend to zero, and we need an alternative method to find the marginal densities.
At a singular point of $\Sigma$ with $s$ self stresses, the number of zero modes increases by $s$, which means that now there are only $m-s$ normal modes.
The zero modes at a singularity are not all tangent to $\Sigma$, which means that the delta function in Eq.~\eqref{eq:mpd} fails to suppress the divergences due to these zero modes when the harmonic approximation is used.
A cartoon of the situation is depicted in Fig.~\ref{fig:intersect}, which shows two branches of a one-dimensional shape space $\Sigma$ intersecting at a singularity $\bar{\bm{q}}^{*}$, where the \ac{cv} has the value $\xi^{*}$.
Because of the additional zero mode, the subspace of zero modes, $\ker\mathsf{C}$, is now a plane, which is tangent to both the branches at the singularity.

How should one proceed in such a situation?
At first glance, one might think that all that is required is to replace the harmonic energy in the previous derivation with the quartic energy expansion, Eq.~\eqref{eq:energy_singular}.
This cannot be correct as Eq.~\eqref{eq:energy_singular} is only valid when the expansion is around the singularity, and our goal here is to find $\mathscr{P}(\xi)$ not just for the singular \ac{cv} value $\xi^{*}$, but for all $\xi \to \xi^{*}$.
When $\xi$ is close to $\xi^{*}$, the ground-state configurations in $\hat{\xi}^{-1}(\xi)$ are all regular points of $\Sigma$ that do not have any singular zero modes.
However, at these configurations, the framework also becomes very soft in certain directions due to the presence of the nearby singularity, causing the harmonic approximation to break down.
A possible strategy could then be to expand the energy to both harmonic and quartic order along these special soft modes, i.e., those that will ultimately become a zero mode at the singularity as we move along $\Sigma$.
Apart from the complexity of such an expansion, this raises another issue: how should one perform Laplace asymptotics around the ground states in $\hat{\xi}^{-1}(\xi)$?
When $\xi$ is close to $\xi^{*}$, the ground states in $\hat{\xi}^{-1}(\xi)$ get infinitesimally close to each other, as do the branches (see Fig.~\ref{fig:intersect}).
Hence, on doing Laplace asymptotics around each of these ground states and on extending the integration domain to infinity, we would be adding contributions to the marginal density from the same region more than once.
In this sense, the contributions from the branches are not separable in the vicinity of the singularity.

From the above discussion, it should be evident that the approach we used in deriving the harmonic marginal density, Eq.~\eqref{eq:mpd_regular}, will not work for finding an asymptotic expression for $\mathscr{P}(\xi)$ for $\xi \to \xi^{*}$.
The only possibility then is to rely on Eq.~\eqref{eq:coarea}, which expresses $\mathscr{P}(\xi)$ as an exact integral over the \ac{cv} level set $\hat{\xi}^{-1}(\xi)$.
Note again that Eq.~\eqref{eq:coarea} makes no reference to the shape space $\Sigma$ as such, enabling us to side step the issues described above.
This however, comes at the expense of having to do a higher-dimensional integral over $\hat{\xi}^{-1}(\xi)$.
The next strategy is to make physically valid assumptions that can be used to dimensionally reduce this integral.

The first such assumption we make is that the \ac{cv} map can be approximated by its Taylor expansion $\hat{\xi} = \xi^{*} + (\nabla\hat{\xi})\bm{q} + \mathcal{O}(\Abs{\bm{q}}^2)$ around the singularity $\bar{\bm{q}}^{*}$ for points close to $\bar{\bm{q}}^{*}$.
with $\nabla\hat{\xi}$ being the Jacobian matrix of $\hat{\xi}$ at $\bar{\bm{q}}^{*}$.
This linearizes the \ac{cv} map and turns its level sets $(\nabla\hat{\xi})^{-1}(\xi - \xi^{*}) = \{\bm{u} \in \mathbb{R}^{n}: \xi^{*} + (\nabla\hat{\xi})\bm{u} = \xi\}$ near the singularity into hyperplanes (see Fig.~\ref{fig:intersect}).
Since this hyperplane is considerably easier to parameterize in comparison to the actual \ac{cv} level set $\hat{\xi}^{-1}(\xi)$, this makes the evaluation of $\mathscr{P}(\xi)$ as a surface integral using Eq.~\eqref{eq:coarea} less difficult.
The second assumption is that the fast modes $\bm{v} \in (\ker\mathsf{C})^{\perp}$ are such that they do not change the value of the \ac{cv} to linear order at the singularity, i.e., $(\nabla\hat{\xi})\bm{v} = 0$.
This enables us to write $\bm{q} = \bm{u} + \bm{v}$, with $\bm{u} \in \ker\mathsf{C}$ and $\bm{v} \in (\ker\mathsf{C})^\perp$, and use the lowest-order approximation of the energy near the singularity [Eq.~\eqref{eq:energy_singular}] to get\footnote{The Jacobian factor introduced by the transformation $\bm{q} \to (\bm{u}, \bm{v})$ is unity if we pick orthonormal bases for $\ker\mathsf{C}$ and $(\ker\mathsf{C})^{\perp}$.}
%
\begin{equation}
  \hspace{-0.5em}
  \begin{aligned}
    \mathscr{P}(\xi) &= \int \dd\bm{q}\, I(\bm{q})\,\delta\left[\hat{\xi}(\bm{q}) - \xi\right] \exp\left[-\beta U(\bm{q})\right]\\
                                 &\sim I(\xi^{*}) \int_{\ker\mathsf{C}} \dd\bm{u}\, \delta\left[(\nabla\hat{\xi})\bm{u} - (\xi - \xi^{*})\right] \int_{(\ker\mathsf{C})^{\perp}} \dd\bm{v}\,  \exp\left\{-\tfrac{1}{2}\beta\kappa[\mathsf{C}\bm{v} + \bm{w}(\bm{u})]\trans[\mathsf{C}\bm{v} + \bm{w}(\bm{u})]\right\},
  \end{aligned}
\end{equation}
%
where we have used $(\nabla\hat{\xi})(\bm{u} + \bm{v}) = (\nabla\hat{\xi})\bm{u}$.
As we can see from the above equation, the second assumption has allowed us to separate the contributions to $\mathscr{P}(\xi)$ from the fast vibrational modes in $(\ker\mathsf{C})^{\perp}$ and the zero modes in $\ker\mathsf{C}$.
As before, we choose the $m - s$ normal modes as the basis for $(\ker\mathsf{C})^{\perp}$ and write $\bm{v} = \mathsf{B}\bm{y}$, with $\mathsf{B}$ being the change-of-basis matrix and $\bm{y} \in \mathbb{R}^{m-s}$ representing the components of $\bm{v}$ in the chosen basis.
This turns the integral over $(\ker\mathsf{C})^{\perp}$ into an $(m-s)$-dimensional Gaussian integral over $\bm{y}$, which after a straightforward integration yields
%
\begin{equation}
  \hspace{-0.5em}
  \begin{aligned}
    \mathscr{P}(\xi) &\sim I(\xi^{*}) \int_{\ker\mathsf{C}} \dd\bm{u}\, \delta\left[(\nabla\hat{\xi})\bm{u} - (\xi - \xi^{*})\right] \int_{\mathbb{R}^{m-s}} \dd\bm{y}\, \exp\left\{-\tfrac{1}{2}\beta\kappa[\mathsf{C}\mathsf{B}\bm{y} + \bm{w}(\bm{u})]\trans[\mathsf{C}\mathsf{B}\bm{y} + \bm{w}(\bm{u})]\right\}\\
                                             &= \frac{I(\xi^{*})}{\left|\det\, \mathsf{D}^\perp\right|^{1/2}} \left(\frac{2\pi}{\beta}\right)^{(m-s)/2} \int_{\ker\mathsf{C}} \dd\bm{u}\, \delta\left[(\nabla\hat{\xi})\bm{u} - (\xi - \xi^{*})\right] \exp\left[-\tfrac{1}{2}\beta\kappa \bm{w}(\bm{u})\trans\Pi \bm{w}(\bm{u})\right],
  \end{aligned}
  \label{eq:mpd_gaussian}
\end{equation}
%
where $\mathsf{D}^\perp$ is the diagonal matrix of the $m - s$ nonzero eigenvalues of $\mathsf{D}$ at the singularity and
%
\begin{equation}
  \Pi = \mathsf{I}_{m} - \mathsf{C}\mathsf{B} (\mathsf{B} ^\mathsf{T}\mathsf{C}^\mathsf{T}\mathsf{C}\mathsf{B} )^{-1}\mathsf{B} ^\mathsf{T}\mathsf{C}^\mathsf{T}
\end{equation}
%
is a projection operator%
\footnote{This operator may be compared with a similar projection operator that appears in the theory of polymerized membranes, once the in-plane components of the elastic free energy (i.e., the fast modes) are integrated out; see, e.g., Eqs.~(6)--(8) of Ref.~\cite{nelson1987}.}
that projects $\bm{w}(\bm{u})$ to the cokernel of $\mathsf{C}\mathsf{B}$ (i.e., to $\ker\mathsf{B}\trans\mathsf{C}\trans$).
Note that this operator would trivially have been the identity matrix if it were not for the cross term $\bm{w}(\bm{u})\trans\mathsf{K}\mathsf{C}\bm{v}$ in the energy expansion, Eq.~\eqref{eq:energy_singular}, that couples the fast modes and the zero modes.
Since the cokernel of $\mathsf{CB}$ is identical to the cokernel of $\mathsf{C}$, it is spanned by an orthonormal basis of self stresses $\bm{\sigma}$, and one can write the action of $\Pi$ on $\bm{w}(\bm{u})$ as
%
\begin{equation}
  \Pi \bm{w}(\bm{u)} = \sum_{\bm{\sigma}} \bm{\sigma}[\bm{\sigma}\cdot\bm{w}(\bm{u})].
  \label{eq:mpd_proj}
\end{equation}
%
Using this in Eq.~\eqref{eq:mpd_gaussian} and after a straightforward application of the coarea formula [Eq.~\eqref{eq:coarea}] we find to the lowest order, for $\xi \to \xi^{*}$,
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\xi) &\sim \frac{I(\xi^{*})}{\left|\det\, \mathsf{D}^\perp\right|^{1/2}} \left(\frac{2\pi}{\beta}\right)^{(m-s)/2} \int_{\ker\mathsf{C}} \dd\bm{u}\, \delta\left[(\nabla\hat{\xi})\bm{u} - (\xi - \xi^{*})\right] \exp\left\{-\tfrac{1}{2}\beta\kappa\sum_{\bm{\sigma}}[\bm{\sigma}\cdot \bm{w}(\bm{u})]^2\right\}\\
                                 &= \frac{I({\xi}^{*})}{\left|\det\, \mathsf{D}^\perp \det\, \nabla\hat{\xi}(\nabla\hat{\xi})\trans\right|^{1/2}}  \left(\frac{2\pi}{\beta}\right)^{(m-s)/2} \int_{\Xi_{\xi}} \dd\Theta(\bm{u})\, \exp\left\{-\tfrac{1}{2}\beta\kappa\sum_{\bm{\sigma}}[\bm{\sigma}\cdot\bm{w}(\bm{u})]^2\right\}.
  \end{aligned}
  \label{eq:mpd_singular}
\end{equation}
%
Above, the integration domain $\Xi_{\xi} = (\nabla\hat{\xi})^{-1}(\xi - \xi^{*}) \cap \ker\mathsf{C}$, is a hyperplane of $(n - m + s) - (n - m) = s$ dimensions and $\dd\Theta(\bm{u})$ is the surface measure on $\Xi_{\xi}$.
After choosing a convenient parameterization for $\Xi_{\xi}$ in terms of the components of $\bm{u}$ in some basis of $\ker\mathsf{C}$, Eq.~\eqref{eq:mpd_singular} becomes an $s$-dimensional integral involving the exponential of a quartic polynomial, which should converge if $\Sigma_{\bm{\sigma}} [\bm{\sigma}\cdot\bm{w}(\bm{u)}]^2$ does not identically vanish in some region of $\Xi_{\xi}$ that extends to infinity (see below for an extended discussion on this).
This completes the derivation of Eq.~\eqref{eq:mpd_singular}.
In deriving Eq.~\eqref{eq:mpd_singular}, unlike in the derivation of Eq.~\eqref{eq:mpd_regular}, we have not looked at contributions to $\mathscr{P}(\xi)$ from the ground states on each branch of $\Sigma$ individually.
Hence, Eq.~\eqref{eq:mpd_singular} represents the collective contribution to the marginal density from all the branches that intersect to form the singularity at $\bar{\bm{q}}^{*}$.

\subsubsection*{Convergence of the integral in \texorpdfstring{Eq.~\eqref{eq:mpd_singular}}{Eq. (5)}}
\label{sec:convergence}

Before discussing the conditions that are required for the integral in Eq.~\eqref{eq:mpd_singular} to converge, we digress slightly and discuss second-order rigidity, a frequently invoked notion in rigidity theory~\cite{connelly1994,connelly1996}.
In the notation that we have been using, a bar-joint framework is considered to be second-order rigid if there are no vector pairs $(\bm{u}, \bm{v})$ with $\bm{u} \in \ker\mathsf{C}$ and $\bm{v} \in (\ker\mathsf{C})^{\perp}$ such that\footnote{Note that this equation is nothing but the Taylor expansion of the constraint map $f$ to the lowest order in $\bm{u}$ and $\bm{v}$.}
%
\begin{equation}
  \mathsf{C}\bm{v} + \bm{w}(\bm{u}) = 0.
\end{equation}
%
For a singular configuration of the framework that supports nonzero self stresses $\bm{\sigma}$, second-order rigidity is equivalent to saying that there is no zero mode $\bm{u} \in \ker\mathsf{C}$ such that\footnote{See, e.g., Corollary 5.2.2 of Ref.~\cite{connelly1996} or Corollaries 4.15--4.17 of Ref.~\cite{williams2003}.}
%
\begin{equation}
  \bm{\sigma}\cdot\bm{w}(\bm{u}) = 0,\label{eq:2ndorder}
\end{equation}
%
for all $\bm{\sigma} \in \ker\mathsf{C}\trans$.
A well-known result is that a bar-joint framework is rigid to all orders if it is second-order rigid~\cite{connelly1996}.

Clearly, a framework is not rigid (to any order) by definition and all tangents to the branches of the shape space $\Sigma$ at a singularity $\bar{\bm{q}}^{*}$ satisfy Eq.~\eqref{eq:2ndorder}.
Even though one can speak of tangent vectors to the branches of $\Sigma$ at $\bar{\bm{q}}^{*}$, the shape space $\Sigma$ itself ceases to be a smooth manifold at $\bar{\bm{q}}^{*}$.
Hence, there is no well-defined tangent space at $\bar{\bm{q}}^{*}$ and it is common practice to consider instead the solution space of Eq.~\eqref{eq:2ndorder},
%
\begin{equation}
  \mathscr{T} = \left\{\bm{t} \in \ker\mathsf{C} : \bm{\sigma}\cdot \bm{w}(\bm{t}) = 0 \text{ for all } \bm{\sigma} \in \ker\mathsf{C}\trans \right\},
  \label{eq:tangentcone}
\end{equation}
%
which is the set of zero modes that preserve the constraints to second-order~\cite{chen2018}.
For this reason, $\mathscr{T}$ is often called the second-order tangent cone.\footnote{See, e.g., Section 4.2 of Ref.~\cite{wu2020}; also see the related discussions in Refs.~\cite{muller2017,muller2019,lopez-custodio2020}.
Tangent cones themselves were originally introduced by \citet{whitney1965} to study tangents to analytic varieties.}
Even though the tangents to the branches of $\Sigma$ belong to $\mathscr{T}$, in general, there could be vectors in $\mathscr{T}$ that are not tangents.
In such situations, the tangents cannot be resolved by considering the second-order tangent cone alone and higher-order analysis is necessary~\cite{muller2017,lopez-custodio2020}.
To simplify things, from here on we assume that the tangents can be resolved at second order, i.e., every element of $\mathscr{T}$ is a tangent to the branches of the shape space $\Sigma$ at the singularity.
For instance, in the cartoon in Fig.~\ref{fig:intersect}, $\mathscr{T}$ would be the union of the two tangents at the singularity.

Now, the integral that defines $\mathscr{P}(\xi)$ also includes a delta function $\delta[\hat{\xi}(\bm{q}) - \xi]$.
After linearizing the \ac{cv} map $\hat{\xi}$ around the singularity and integrating out the fast modes, the domain of integration in Eq.~\eqref{eq:mpd_singular} becomes the hyperplane $\Xi_{\xi} = \ker\mathsf{C} \cap (\nabla\hat{\xi})^{-1}(\xi - \xi^{*})$.
At a singularity with $s$ self stresses $\bm{\sigma}_{1}, \bm{\sigma}_{2}, \ldots, \bm{\sigma}_{s}$, consider the map $g: \ker\mathsf{C} \to \mathbb{R}^{n - m + s}$ defined by $g(\bm{u}) = [(\nabla\hat{\xi})\bm{u} - (\xi - \xi^{*}), \bm{\sigma}_{1}\cdot \bm{w}(\bm{u}), \bm{\sigma}_{2}\cdot \bm{w}(\bm{u}), \ldots, \bm{\sigma}_{s}\cdot \bm{w}(\bm{u})]$.
In a basis of $\ker\mathsf{C}$, the equation $g(\bm{u}) = 0$ defines an exactly determined system of equations in $n-m+s$ unknowns, whose solutions (if they exist) are tangents that belong to $\Xi_{\xi}$.
If this equation has isolated roots, then the term $\sum_{\bm{\sigma}} [\bm{\sigma}\cdot\bm{w}(\bm{u})]^{2}$ in the exponential of Eq.~\eqref{eq:mpd_singular} is zero only for a discrete set of tangent vectors in $\Xi_{\xi}$ and is positive everywhere else, making the integral convergent.
(In Fig.~\ref{fig:intersect}, this discrete set is composed of the tangents to the two branches, which when extended intersect the line $\Xi_{\xi}$, which is the domain of integration.)
A necessary condition for the equation $g(\bm{u}) = 0$ to have isolated roots in $\Xi_{\xi}$ is that $(\nabla\hat{\xi})\bm{t} \neq 0$ for all $\bm{t} \in \mathscr{T}$.
Given how $g(\bm{u})$ is a system of $n - m$ linear and $s$ quadratic equations, a stronger general condition that ensures this eludes us at present.
On the other hand, if there is a tangent $\bm{t}$ such that $(\nabla\hat{\xi})\bm{t} = 0$, the integral diverges.
Such cases are pathological and indicate a poor \ac{cv} choice.
After all, if $\bm{t}$ is a tangent to $\Sigma$, then it is a slow mode that corresponds to a shape change in the framework, and one would definitely want the value of the \ac{cv} to change along it.

To conclude, the convergence of Eq.~\eqref{eq:mpd_singular} relies on the term $\sum_{\bm{\sigma}}[\bm{\sigma}\cdot\bm{w}(\bm{u})]^{2}$ in the exponential vanishing only for a finite number of isolated points in the integration domain $\Xi_{\xi}$.
Two necessary conditions required for this are: (i) tangents to the branches of the shape space at the singularity can be resolved at second order and form the solution space $\mathscr{T}$ of Eq.~\eqref{eq:2ndorder}, and (ii) the \ac{cv} map is such that $(\nabla\hat{\xi})\bm{t} \neq 0$ for all $\bm{t} \in \mathscr{T}$.

\subsubsection*{Scaling of the marginal density}
\label{sec:scaling}

To see how the marginal density $\mathscr{P}(\xi^{*})$ at a singular value $\xi^{*}$ scales with $\beta$ and $\kappa$, we first choose a basis for $\ker\mathsf{C}$ so that $\bm{u} = \mathsf{A}\bm{x}$, where $\bm{x} \in \mathbb{R}^{n-m+s}$ represents the components of $\bm{u}$ in the chosen basis and $\mathsf{A}$ is the associated change-of-basis matrix.
Now, the $s$-dimensional hyperplane $\Xi_{\xi}$ formed by the intersection of the linearized \ac{cv} level set and $\ker\mathsf{C}$ is defined by $\nabla\hat{\xi}\mathsf{A}\bm{x} = 0$, which is a set of $n-m$ homogeneous linear equations in $n-m+s$ variables.
Without loss of generality, let us assume that we can solve these equations to obtain the last $n - m$ components of $\bm{x}$ in terms of its first $s$ components $\tilde{\bm{x}} = (x_{1}, x_{2}, \ldots, x_{s})$.
This enables us to parameterize the hyperplane $\Xi_{\xi}$ using $\tilde{\bm{x}}$.
As each component of the vector $\bm{w}(\bm{u})$ is a quadratic form in $\bm{x}$, after the elimination step, the term $\sum_{\bm{\sigma}}[\bm{\sigma}\cdot\bm{w}(\bm{u})]^{2}$ in the exponential of Eq.~\eqref{eq:mpd_singular} becomes a homogeneous quartic polynomial $\widetilde{U}(\tilde{\bm{x}})$.
A rescaling of the components $\tilde{\bm{x}} \to (\beta\kappa)^{-1/4}\tilde{\bm{x}}$, changes the surface measure from $\dd\Theta(\tilde{\bm{x}}) \to (\beta\kappa)^{-s/4}\dd\Omega(\tilde{\bm{x}})$ and turns $\widetilde{U}(\tilde{\bm{x}}) \to (\beta\kappa)^{-1}\widetilde{U}(\tilde{\bm{x}})$, yielding
%
\begin{equation}
  \mathscr{P}(\xi^{*}) \sim \frac{I({\xi}^{*})}{\left|\kappa^{s/2}\det\,\mathsf{D}^\perp \det\, \nabla\hat{\xi}(\nabla\hat{\xi})\trans\right|^{1/2}}  \left(\frac{2\pi}{\beta}\right)^{m/2 - s/4} \int_{\Xi_{\xi}} \dd\Theta(\tilde{\bm{x}})\, \exp\left[-\tfrac{1}{2}\widetilde{U}(\tilde{\bm{x}})\right].
  \label{eq:scaling}
\end{equation}
%
Clearly, the above integral is purely geometric in nature and all $\beta$ dependence has been extracted
Finally, noting that $\det\,\mathsf{D}^{\perp} \sim \kappa^{m - s}$ we see that the marginal density $\mathscr{P}(\xi^{*}) \sim (\beta\kappa)^{-m/2 + s/4}$.
It should be emphasized that we can only do this analysis for $\xi = \xi^{*}$.
For other values of $\xi$ close to $\xi^{*}$, the hyperplane $\Xi_{\xi}$ is defined by the inhomogeneous equation $\nabla\hat{\xi}\mathsf{A}\bm{x} = \xi - \xi^{*}$, which makes $\widetilde{U}(\tilde{\bm{x}})$ a similarly inhomogeneous quartic polynomial, making a rescaling argument impossible.

The marginal density for regular values of the \ac{cv}, which scales like $\mathscr{P}(\xi) \sim (\beta\kappa)^{-m/2}$ [Eq.~\eqref{eq:mpd_regular}], is always subdominant to the marginal density at a singular value $\xi^{*}$, which scales like $\mathscr{P}(\xi^{*}) \sim (\beta\kappa)^{-m/2 + s/4}$ for $s > 0$.
Hence, we see that the softening of the framework at a singularity causes an energetic free-energy barrier to develop between regular and singular values of the \ac{cv}, with a temperature/stiffness dependence $\sim \ln \beta\kappa$.
In comparison, the free-energy barriers between singular values of the \ac{cv} are independent of $\beta$ and $\kappa$, and depend only on geometric parameters if the corresponding configurations have the same number of self stresses $s$.
Although this might lead us to conclude that such barriers are entropic in origin, note that there would be energetic barriers along most realizable transition paths separating these configurations.

The stark difference in the asymptotic scaling of $\mathscr{P}(\xi)$ at a singular value $\xi = \xi^{*}$ and for values farther from it shows that the true scaling and behavior of $\mathscr{P}(\xi)$ for intermediate values of $\xi$ is nontrivial.
A natural question is then: for what values of $\xi$ would the harmonic and quartic approximations capture the true behavior of $\mathscr{P}(\xi)$?
Equation~\eqref{eq:mpd_regular}, derived using the harmonic approximation and a direct application of Laplace's method, is only accurate so long as the lowest nonzero eigenvalue $\omega_{\text{min}}(\xi)$ of the dynamical matrix $\mathsf{D}$ is such that $\beta\omega_{\text{min}}(\xi)$ is very large.
This is also what causes it to break down as we approach a singularity, near which $\omega_{\text{min}}(\xi)$ monotonically\footnote{For one-dimensional shape spaces, using Rayleigh--Schr\"{o}dinger perturbation theory~\cite{dirac1958} and considering the dynamical matrix at the singularity as the ``unperturbed Hamiltonian'', it can be shown that $\omega_{\text{min}} \sim (\xi - \xi^{*})^{2}$ for $\xi \to \xi^{*}$.} decreases to zero as $\xi \to \xi^{*}$.
This also implies that as $\beta$ becomes larger, the harmonic approximation starts capturing the true behavior of the marginal density for a larger range of $\xi$ values.
For very large $\beta$, the range of validity of the quartic approximation is also bound to increase as the errors in the approximation become small.
This means that, for large $\beta$, we expect to see some amount of overlap in the marginal density estimates using Eqs.~\eqref{eq:mpd_regular} and \eqref{eq:mpd_singular} as evidenced by the free-energy curves in Figs.~\ref{fig:4bar_free} and \ref{fig:origami}(c).
We expect the exact nature of the overlap to be problem specific with a strong dependence on $\beta$ and we leave a more thorough analysis for future work.

\smallbreak
We now use our formalism to find the free-energy profiles of three example frameworks with one-dimensional shape spaces with isolated singularities and compare them with results from Monte Carlo simulations.
We will also use our formalism to analyze the five-bar linkage, a framework with a two-dimensional shape space.
Motivated by typical DNA origami structures that have lengths in the range of a few hundred nanometers with stiffness in the range 0.1--1~pN$/$nm~\cite{jung2020}, we choose a nondimensional inverse temperature of $\beta = 10^{4}$ and use a potential of the form $\phi_{i}(\ell_{i}) = (\ell_{i}^{2} - \bar{\ell}_{i}^{2})^{2}/(8\bar{\ell}_{i}^{2})$ so that $\phi_{i}''(\bar{\ell}_{i}) = \kappa = 1$.
Further details on the simulations are given in Appendix~\ref{sec:numerics}.

\section{Example: planar four-bar linkage}
\label{sec:4bar}

The four-bar linkage we consider (Fig.~\ref{fig:4bar}) is made out of two sets of bars of lengths $a$ and $\lambda a$, where $\lambda > 0$ is a dimensionless aspect ratio.
For $\lambda \ne 1$, the linkage has shape-space singularities at $\theta_{1} = 0$ and $\theta_{1} = \pm \pi$ where the bars become collinear and support a state of self stress.%
\footnote{For simplicity, we do not discuss the square four-bar linkage with $\lambda=1$ here as it has additional singularities at $(\theta_{1}, \theta_{2}) = (0, \pm\pi)$~\cite{yang1994}.}
The shape space can be fully parameterized using the angle $\theta_{1}$, which we use as our \ac{cv}.

\subsection{Body frame}

Rigid motions can be integrated out by transforming to a local Cartesian coordinate system (body frame) attached to the four-bar linkage with joint~1 at the origin and bar~1--2 lying along the horizontal axis as shown in Fig.~\ref{fig:4bar}.
Let $(r_{i1}, r_{i2}),\, i = 1, 2, 3, 4$ be the coordinates of the four joints in the lab frame.
The configuration vector $\bm{q} \in \mathbb{R}^{5}$ of the linkage in the body frame is $\bm{q} = (q_{1}, q_{2}, \ldots, q_{5})$.
Also, two translational coordinates $x_{1}, x_{2}$ specify the position of joint~1, and an orientational coordinate $\eta$, which is the angle between the horizontal axes of the lab and body frames, gives the overall rotation of the linkage.
The explicit coordinate transformation $\bm{r} \to (x_{1}, x_{2}, \eta, \bm{q})$ is given by
%
\begin{equation}
  \begin{aligned}
    \inmat{r_{11} \\ r_{12}} &= \inmat{x_{1} \\ x_{2}}, {}&
    \inmat{r_{21} \\ r_{22}} &= \inmat{x_{1} \\ x_{2}} + \mathsf{R}(\eta)\inmat{q_1 \\ 0},\\
    \inmat{r_{31} \\ r_{32}} &= \inmat{x_{1} \\ x_{2}} + \mathsf{R}(\eta)\inmat{q_2 \\ q_3}, {}&
    \inmat{r_{41} \\ r_{42}} &= \inmat{x_{1} \\ x_{2}} + \mathsf{R}(\eta)\inmat{q_4 \\ q_5}.
  \end{aligned}
  \label{eq:4bar_trans}
\end{equation}
%
Here $\mathsf{R}(\eta)$ is the rotation matrix in $\mathbb{R}^2$.
Dropping the constant factor that one gets after integrating over $x_1, x_2, \text{and } \eta$, the overall Jacobian factor involved in the transformation given by Eq.~\eqref{eq:4bar_trans} is
%
\begin{equation}
  I(\bm{q}) = \abs{q_1}.
  \label{eq:4bar_jacobian}
\end{equation}
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/4bar.pdf}
  \end{center}
  \caption{Body frame on the planar four-bar linkage with joint~1 at the origin and bar~1--2 lying along the horizontal axis.
    The angle between the horizontal axes of the body and lab frame is $\eta$.}
  \label{fig:4bar}
\end{figure}

\subsection{Branch parameterization}

The four-bar linkage admits two modes of deformations, giving its shape space a branched appearance.
On the parallel branch the angles $\theta_{1}$ and $\theta_{2}$ are equal, whereas on the twisted branch they have a nonlinear relationship with opposite signs.
To find the exact relationship between $\theta_{1}$ and $\theta_{2}$ on the twisted branch, we first write down the constraint equation for bar~3--4 (see Fig.~\ref{fig:4bar}) of the four-bar linkage:
%
\begin{equation}
  [\lambda a + a(\cos{\theta_2} - \cos{\theta_1})]^2 + (a\sin{\theta_2} - a\sin{\theta_1})^2 = \lambda^2 a^2.
\end{equation}
%
Assuming that the aspect ratio $\lambda \ne 1$, this equation can be simplified and factorized in two different ways to get
%
\begin{subequations}
\begin{align}
  \left[\cos{\theta_2} - \cos{\theta_1}\right]\left[\cos{\theta_2} - \frac{(1 + \lambda^2)\cos{\theta_1} - 2\lambda}{1 - 2\lambda\cos{\theta_1} + \lambda^2}\right] &= 0,\\
  \left[\sin{\theta_2} - \sin{\theta_1}\right]\left[\sin{\theta_2} - \frac{(1 - \lambda^2)\sin{\theta_1}}{1 -2\lambda\cos{\theta_1} + \lambda^2}\right] &= 0.
\end{align}
\end{subequations}
%
The solutions to the above equations tell us the relationship between the ``input'' angle $\theta_1$ and the ``output'' angle $\theta_2$ on the two branches, e.g., on the parallel branch
%
\begin{equation}
  \cos\theta_2 = \cos\theta_1,\qquad
  \sin\theta_2 = \sin\theta_1\,;
  \label{eq:parallel}
\end{equation}
%
and on the twisted branch
%
\begin{equation}
  \cos\theta_2 = \frac{(1 + \lambda^2)\cos{\theta_1} - 2\lambda}{1 - 2\lambda\cos{\theta_1} + \lambda^2}, \qquad
  \sin\theta_2 = \frac{(1 - \lambda^2)\sin{\theta_1}}{1 - 2\lambda\cos{\theta_1} + \lambda^2},
  \label{eq:twisted}
\end{equation}
%
which is what we intended to find.
We can express a point $\bar{\bm{q}}$ in the shape space $\Sigma \subset \mathbb{R}^5$ of the four-bar linkage in terms of the angles $\theta_1$ and $\theta_2$ as $\bar{\bm{q}} = [\lambda a,\, a(\lambda + \cos{\theta_2}),\, a\sin{\theta_2},\, a\cos{\theta_1},\, a\sin{\theta_1}]$.
Using Eqs.~\eqref{eq:parallel} and \eqref{eq:twisted} we find two parameterizations for $\Sigma$, namely $\psi_+: \mathbb{R} \to \mathbb{R}^5$ (parallel branch) and $\psi_-: \mathbb{R} \to \mathbb{R}^5$ (twisted branch), defined by
%
\begin{subequations}
  \begin{align}
    \psi_+(\theta_1) &= \left[\lambda a, a(\lambda + \cos{\theta_1}), a\sin{\theta_1}, a\cos{\theta_1}, a\sin{\theta_1}\right],\label{eq:4bar_param_parallel}\\
    \psi_-(\theta_1) &= \left[\lambda a, a\frac{(1-\lambda^2)(\cos{\theta_1} - 1)}{1-2\lambda\cos{\theta_1}+\lambda^2}, a\frac{(1-\lambda^2)\sin{\theta_1}}{1-2\lambda\cos{\theta_1}+\lambda^2}, a\cos{\theta_1}, a\sin{\theta_1}\right].\label{eq:4bar_param_twisted}
  \end{align}
\end{subequations}
%
The above equations define two curves in $\mathbb{R}^{5}$ parameterized by the angle $\theta_{1}$.
The induced metric on these two curves can be readily computed as
%
\begin{subequations}
  \begin{align}
    (\nabla\psi_{+})\trans\nabla\psi_+ &= \Abs{\partial{\psi_{+}}/\partial{\theta_{1}}}^{2} = 2 a^2,\label{eq:4bar_ind1}\\
    (\nabla\psi_{-})\trans\nabla\psi_- &= \Abs{\partial{\psi_{-}}/\partial{\theta_{1}}}^{2} = \frac{2a^2[1-2\lambda(1-\lambda\cos{\theta_1}+\lambda^2)\cos{\theta_1} + \lambda^4]}{(1-2\lambda\cos{\theta_1}+ \lambda^2)^2}.\label{eq:4bar_ind2}
  \end{align}
\end{subequations}

\subsection{Marginal probability densities}

\subsubsection*{Regular values}

Now that we have explicit parameterizations of the two branches of the four-bar linkage in terms of the \ac{cv} $\theta_{1}$, we can find the marginal density $\mathscr{P}(\theta_{1})$ at regular values of $\theta_{1}$, far from the singular values, i.e., for $0 \ll \abs{\theta_{1}} \ll \pi$.
Note that for each value of $\theta_{1}$, there are two ground states---one on the parallel branch and one on the twisted branch.
This means that we need to separately find the contributions of these ground states using Eq.~\eqref{eq:mpd_regular} and then add them together to obtain $\mathscr{P}(\theta_{1})$.

Starting with constraint function for bar~1--2 and going around the linkage in counterclockwise order, we find the constraint map $f: \mathbb{R}^{5} \to \mathbb{R}^{4}$ in the body frame to be
%
\begin{equation}
  f(\bm{q}) = \left[\frac{q_1^2 - \lambda^2 a^2}{2\lambda a},\, \frac{(q_2 - q_1)^2 + q_3^2 - a^2}{2a},\, \frac{(q_4 - q_2)^2 + (q_5 - q_3)^2 - \lambda^2 a^2}{2\lambda a},\, \frac{q_4^2 + q_5^2 - a^2}{2a}\right],
\end{equation}
%
and the compatibility matrix $\mathsf{C}$ to be
%
\begin{equation}
  \mathsf{C} = \nabla f = a^{-1}\begin{pmatrix}
    \lambda^{-1}q_1 & 0 & 0 & 0 & 0 \\
    (q_1-q_2) & q_2-q_1 & q_3 & 0 & 0\\
    0 & \lambda^{-1}(q_2-q_4) & \lambda^{-1}(q_3-q_5) & \lambda^{-1}(q_4-q_2) & \lambda^{-1}(q_5-q_3)\\
  0 & 0 & 0 & q_4 & q_5
  \label{eq:4bar_compatibility}
\end{pmatrix}.
\end{equation}
At regular points $\mathsf{C}$ has full rank, which implies that the dynamical matrix $\mathsf{D} = \mathsf{C}\trans\mathsf{K}\mathsf{C}$ and the matrix $\mathsf{K}\mathsf{C}\mathsf{C}\trans$ have the same nonzero eigenvalues.
This gives $\det\,\mathsf{D}^\perp = \det\,\mathsf{K}\mathsf{C}\mathsf{C}\trans = \kappa^4\det\,\mathsf{C}\mathsf{C}\trans$.
Inserting the parameterizations from Eqs.~\eqref{eq:4bar_param_parallel} and \eqref{eq:4bar_param_twisted} into the compatibility matrix we compute $\det\,\mathsf{D}^\perp$ along the two branches as
%
\begin{subequations}
\begin{align}
  \det\,\mathsf{D}^\perp_+ &= 2\kappa^4\sin^2\theta_1,\\
  \det\,\mathsf{D}^\perp_- &= \frac{2\kappa^4\sin^2{\theta_1}[1-2\lambda(1-\lambda\cos{\theta_1}+\lambda^2)\cos{\theta_1} + \lambda^4]}{(1-2\lambda\cos{\theta_1}+\lambda^2)^2}.
\end{align}
\end{subequations}
%
The asymptotic marginal density is then
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\theta_1) &\sim I(\theta_1)\left(\frac{2\pi}{\beta}\right)^2\left[\left|\frac{\det\,(\nabla\psi_{+})\trans\nabla\psi_+}{\det\,\mathsf{D}_+^\perp}\right|^{1/2} + \left|\frac{\det\,(\nabla\psi_{-})\trans\nabla\psi_-}{\det\,\mathsf{D}_-^\perp}\right|^{1/2}\right]\\
                                           &= 2\lambda a^{2}\left(\frac{2\pi}{\beta\kappa}\right)^2|\sin{\theta_1}|^{-1},
  \end{aligned}
  \label{eq:4bar_r}
\end{equation}
where we have used $I(\theta_{1}) = \abs{q_{1}} = \lambda a$ [Eq.~\eqref{eq:4bar_jacobian}] and the expressions for the induced metrics [Eqs.~\eqref{eq:4bar_ind1} and \eqref{eq:4bar_ind2}] computed earlier.

\subsubsection*{Singular values}

The four-bar linkage has shape-space singularities at $\theta_1 = 0$ and $\theta_1 = \pm\pi$ corresponding to configurations where the bars are collinear.
Let us first look at the singularity at $\theta_1 = 0$, where the configuration vector $\bar{\bm{q}}^{*} = [\lambda a, a(\lambda + 1), 0, a, 0]$.
The compatibility and dynamical matrices at this point are
%
\begin{equation}
  \mathsf{C} =
  \begin{pmatrix}
  1  & 0 & 0 & 0  & 0 \\
  -1 & 1 & 0 & 0  & 0 \\
  0  & 1 & 0 & -1 & 0 \\
  0  & 0 & 0 & 1  & 0 \\
  \end{pmatrix}
  \quad\text{and}\quad
  \mathsf{D} = \mathsf{C}\trans\mathsf{K}\mathsf{C} = \kappa
  \begin{pmatrix}
    2  & -1 & 0 & 0  & 0 \\
    -1 & 2  & 0 & -1 & 0 \\
    0  & 0  & 0 & 0  & 0 \\
    0  & -1 & 0 & 2  & 0 \\
    0  & 0  & 0 & 0  & 0 \\
  \end{pmatrix}.
\end{equation}
%
The dynamical matrix has nonzero eigenvalues $(2+\sqrt{2})\kappa$, $2\kappa$, and $(2-\sqrt{2})\kappa$, which gives $\det\,\mathsf{D}^\perp = 4\kappa^3$.
Also, the Hessian matrices of the four constraint functions $f_i$ at the singularity~are

\begin{equation}
\begin{aligned}
  \hess f_1 &=
  (\lambda a)^{-1}\begin{pmatrix}
    1 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
  \end{pmatrix},\qquad {}&
  \hess f_2 &= a^{-1}
  \begin{pmatrix}
    1 & -1 & 0 & 0 & 0 \\
    -1 & 1 & 0 & 0 & 0 \\
    0 & 0 & 1 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
  \end{pmatrix},\qquad\\
  \hess f_3 &=
  (\lambda a)^{-1}\begin{pmatrix}
    0 & 0 & 0 & 0 & 0 \\
    0 & 1 & 0 & -1 & 0 \\
    0 & 0 & 1 & 0 & -1 \\
    0 & -1 & 0 & 1 & 0 \\
    0 & 0 & -1 & 0 & 1 \\
  \end{pmatrix},\qquad {}&
  \hess f_4 &= a^{-1}
  \begin{pmatrix}
      0 & 0 & 0 & 0 & 0 \\
      0 & 0 & 0 & 0 & 0 \\
      0 & 0 & 0 & 0 & 0 \\
      0 & 0 & 0 & 1 & 0 \\
      0 & 0 & 0 & 0 & 1 \\
  \end{pmatrix}.
\end{aligned}
\end{equation}

As we remarked in Section~\ref{sec:singular}, when using Eq.~\eqref{eq:mpd_singular} to find the marginal density $\mathscr{P}(\mathscr{\theta}_{1})$, we will not make use of the parameterizations we derived earlier [Eqs.~\eqref{eq:4bar_param_parallel} and \eqref{eq:4bar_param_twisted}].
Instead, we need to first linearize the \ac{cv} map at the singularity.
Since the \ac{cv} we have chosen for the four-bar linkage is the angle $\theta_{1}$, the \ac{cv} map that computes $\theta_{1}$ from the configuration vector $\bm{q}$ is $\hat{\theta}_{1}(\bm{q}) = \tan^{-1}(q_{5}/q_{4})$.\footnote{To be more rigorous, we should be using the two-argument variant of the inverse tangent, sometimes denoted as $\mathrm{atan2}(q_{5},q_{4})$ in numerical software, so that $\theta_{1}$ is in $(-\pi, \pi]$ instead of $(-\pi/2,\pi/2)$.  This is not an issue for the linearization since $\theta_{1}$ is small.}
This map has the Jacobian $\nabla\hat{\theta}_1 = \inmat{0 & 0 & 0 & 0 & a^{-1}}$ at the singularity.
Direct inspection reveals that $(\nabla\hat{\theta}_{1})\bm{v} = 0$ for all fast modes $\bm{v} \in (\ker\mathsf{C})^{\perp}$, justifying the usage of Eq.~\eqref{eq:mpd_singular} to find $\mathscr{P}(\mathscr{\theta}_{1})$ when $\theta_{1} \to 0$.
This would not have been the case if, for instance, we had chosen the coordinate $q_{4}$ of joint~4 of the four-bar linkage (see Fig.~\ref{fig:4bar}), as our \ac{cv}.
In such a case $\nabla{q_{4}} = \inmat{0 & 0 & 0 & 1 & 0}$ and the fast modes, all of which are along the collinear bars with a nonzero fourth component, do not satisfy $(\nabla q_{4})\bm{v} = 0$.
Incidentally, in this case, the tangent vectors $\bm{t}$ at the singularity are such that $(\nabla q_{4})\bm{t} = 0$, which also makes $q_{4}$ a poor choice as the \ac{cv} since it does not capture the slow modes along $\bm{t}$.
Continuing with $\theta_{1}$ as our \ac{cv}, to evaluate the integral in Eq.~\eqref{eq:mpd_singular}, we choose the vector $\bm{u} \in \ker \mathsf{C}$ to be $\bm{u} = (0, 0, q_3, 0, q_{5})$, so that the vector $\bm{w}(\bm{u})$ is
%
\begin{equation}
  \begin{aligned}
    \bm{w}(\bm{u}) &= \left(\tfrac{1}{2}\bm{u}\trans \hess f_1 \bm{u},\, \tfrac{1}{2}\bm{u}\trans\hess f_2\bm{u},\, \tfrac{1}{2}\bm{u}\trans\hess f_3\bm{u},\, \tfrac{1}{2}\bm{u}\trans\hess f_4\bm{u} \right)\\
      &= \left[0,\,q_3^2/(2a),\,(q_3-q_5)^2/(2\lambda a),\,q_5^2/(2a)\right].
  \end{aligned}
  \label{eq:4bar_w}
\end{equation}
%
There is only one self stress $\bm{\sigma}\in \ker\mathsf{C}\trans$ at the singularity, and it is $\bm{\sigma} = \left(-1/2, -1/2, 1/2, 1/2\right)$.
Using this in Eq.~\eqref{eq:mpd_singular} along with $(\nabla\hat{\theta}_{1})\bm{u} = a^{-1}q_{5}$ and the fact that $\det\,\mathsf{D}^\perp = 4\kappa^3$, we get%
\footnote{From the argument of the Dirac delta function, we see that the ``hyperplane'' $\Xi_{\xi}$ in Eq.~\eqref{eq:mpd_singular} is just the line along $q_{5} = a\theta_{1}$ in the $q_{3}$-$q_{5}$ plane.}
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\theta_1) %&\sim \frac{\lambda a}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}\int \dd{q}_3\, \dd{q}_5\, \delta\left[(\nabla\hat{\theta}_{1})\bm{u} - \theta_1\right]\exp\left[-\tfrac{1}{2}\beta\kappa(\bm{\sigma}\cdot\bm{w})^2\right]\\
                                           &\sim \frac{\lambda a}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}\Biggl(\int_{-\infty}^{\infty} \dd{q}_3\, \dd{q}_{5}\, \delta(a^{-1}q_{5} - \theta_{1})\\
                                           &\phantom{\sim \frac{\lambda a}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}}\quad\times\exp\left\{-\frac{\beta\kappa}{32\lambda^2a^2}\left[q_3 - q_5\right]^2\left[(\lambda-1)q_3 + (\lambda+1)q_5\right]^2\right\}\Biggr)\\
                                           &= \frac{\lambda a^2}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}\int_{-\infty}^{\infty} \dd{q}_3\, \exp\left\{-\frac{\beta\kappa}{32\lambda^2a^2}\left[q_3 - a\theta_{1}\right]^2\left[(\lambda-1)q_3 + (\lambda+1)a\theta_{1}\right]^2\right\}.
  \end{aligned}
  \label{eq:4bar_mpd_int}
\end{equation}
%
At this point, it is useful to revisit the convergence criteria for Eq.~\eqref{eq:mpd_singular}, i.e., the requirement that the term $\sum_{\bm{\sigma}} [\bm{\sigma}\cdot \bm{w}(\bm{u})]^{2}$ in the exponential of Eq.~\eqref{eq:mpd_singular} must only have isolated zeros. In the above equation, this term is $[q_3 - a\theta_{1}]^{2}[(\lambda-1)q_3 + (\lambda+1)a\theta_{1}]^{2}/(16\lambda^{2}a^{2})$, which has isolated zeros $q_{3} = a\theta_{1}$ and $q_{3} = (1+\lambda)a\theta_{1}/(1-\lambda)$, consistent with the convergence requirement.

To evaluate the integral in Eq.~\eqref{eq:4bar_mpd_int}, we symmetrize the expression in the exponential by changing variables $q_3 \to q_3 - (\lambda-1)^{-1}a\theta_1$, which yields
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\theta_1) &\sim \frac{\lambda a^2}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}\int_{-\infty}^{\infty} \dd q_3\, \exp\left\{-\frac{\beta\kappa(\lambda-1)^2}{32\lambda^2 a^2}\left[q_3^2 - \frac{\lambda^2 a^2\theta_1^2}{(\lambda-1)^2}\right]^2\right\}\\
                                           &= \lambda a^2\frac{(2\pi)^{3/2}}{(\beta\kappa)^{7/4}}\sqrt{\frac{\lambda{a}}{\abs{\lambda-1}}}\exp\left[-\frac{\beta\kappa\lambda^2a^2\theta_1^4}{32(\lambda-1)^2}\right]\int_{0}^{\infty} \dd x\, x^{-1/2}\exp\left(-\tfrac{1}{2}x^2 + \frac{\sqrt{\beta\kappa}\lambda a\theta_1^2}{4\abs{\lambda-1}}x\right)\\
                                           &= \lambda a^2\frac{(2\pi)^{3/2}}{(\beta\kappa)^{7/4}}\sqrt{\frac{\pi\lambda{a}}{\abs{\lambda-1}}}\exp\left[-\frac{\beta\kappa\lambda^2a^2\theta_1^4}{64(\lambda-1)^2}\right]D_{-1/2}\left(-\frac{\sqrt{\beta\kappa}\lambda a\theta_1^2}{4\abs{\lambda-1}}\right),
  \end{aligned}
  \label{eq:4bar_0}
\end{equation}
%
where $D_{-1/2}(\cdot)$ is the parabolic cylinder function~\cite[Eq.~12.5.1]{olver2010}.

For the singularity at $\theta_{1} = \pm\pi$, we have $\bar{\bm{q}}^{*} = [\lambda a, (\lambda-1)a, 0, -a, 0]$ and we proceed with a similar calculation.
The dynamical matrix and the Hessians of the constraint functions at this point is identical to those at $\theta_{1} = 0$.
Hence, we choose the vector $\bm{u}$ as before, yielding the same $\bm{w}(\bm{u})$ as in Eq.~\eqref{eq:4bar_w}.
However, the self stress at $\theta_1 = \pm\pi$ is different and it is $\bm{\sigma} = \left(-1/2, -1/2, -1/2, 1/2\right)$.
Using these results, we can evaluate the integral in Eq.~\eqref{eq:mpd_singular} as before to get
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\theta_1) &\sim \frac{\lambda a^2}{2}\left(\frac{2\pi}{\beta\kappa}\right)^{3/2}\int_{-\infty}^{\infty} \dd{q}_3\, \exp\left\{-\frac{\beta\kappa(\lambda+1)^2}{32\lambda^2 a^2}\left[q_3^2 - \frac{\lambda^2 a^2(\pi-\abs{\theta_1})^2}{(\lambda+1)^2}\right]^2\right\}\\
                                           &= \lambda a^2\frac{(2\pi)^{3/2}}{(\beta\kappa)^{7/4}}\sqrt{\frac{\pi\lambda{a}}{\lambda+1}}\exp\left[-\frac{\beta\kappa\lambda^2a^2(\pi-\abs{\theta_1})^4}{64(\lambda+1)^2}\right]D_{-1/2}\left[-\frac{\sqrt{\beta\kappa}\lambda a(\pi-\abs{\theta_1})^2}{4(\lambda+1)}\right].
  \end{aligned}
  \label{eq:4bar_pi}
\end{equation}

Note that the marginal densities at the singular values of $\theta_{1}$, i.e., $\mathscr{P}(0)$ and $\mathscr{P}(\pm\pi)$, scale as $(\beta\kappa)^{-7/4}$.
Since $m = 4$ and the number of self stresses $s = 1$ at the singularities, this is consistent with the general scaling $\mathscr{P}(\xi^{*}) \sim (\beta\kappa)^{-(m/2 - s/4)}$ for singular values $\xi^{*}$ of the \ac{cv} [Eq.~\eqref{eq:scaling}].
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/4bar_free.pdf}
  \end{center}
  \caption{Free-energy difference $\Delta\mathscr{A}(\theta_1)$ of a four-bar linkage with parameters $a=1$ and $\lambda=2$ in units of $\beta^{-1}$ at $\beta = 10^{4}$.
  The inset shows the absolute errors between the numerical and asymptotic results using the harmonic and quartic approximations [Eq.~\eqref{eq:4bar_free}].}
  \label{fig:4bar_free}
\end{figure}

\subsection{Free energy}

Using the marginal densities we have found for various regimes of $\theta_{1}$ [Eqs.~\eqref{eq:4bar_r}, \eqref{eq:4bar_0}, and \eqref{eq:4bar_pi}] we see that the free-energy difference of the four-bar linkage $\Delta\mathscr{A}(\theta_1) = \mathscr{A}(\theta_1) - \mathscr{A}(0) = -\beta^{-1}\log{\mathscr{P}(\theta_1)} + \beta^{-1}\log{\mathscr{P}(0)}$ takes the form
%
\begin{equation}
  \Delta\mathscr{A}(\theta_1) \sim
\begin{dcases}
  \beta^{-1}\left\{X^2\theta_1^4 - \ln\left[\dfrac{D_{-1/2}(-2X\theta_1^2)}{D_{-1/2}(0)}\right]\right\}, & \theta_1 \to 0\\
  \beta^{-1}\ln\left[X^{1/2}D_{-1/2}(0)\abs{\sin{\theta_1}}\right], & 0 \ll \abs{\theta_1} \ll \pi\\
  \beta^{-1}\left(X^2Y^2(\pi - \abs{\theta_1})^4 - \ln\left\{Y^{1/2}\dfrac{D_{-1/2}\left[-2XY(\pi - \abs{\theta_1})^2\right]}{D_{-1/2}(0)}\right\}\right), & \abs{\theta_1} \to \pi
\end{dcases}
  \label{eq:4bar_free}
\end{equation}
%
where $X$ and $Y$ are positive dimensionless terms independent of $\theta_1$ and defined by
%
\begin{equation}
  X = \frac{\sqrt{\beta\kappa}\lambda a}{8\abs{\lambda-1}},\qquad
  Y = \left|\frac{\lambda-1}{\lambda+1}\right|.
  \label{eq:XandY}
\end{equation}
%
From Eq.~\eqref{eq:4bar_free}, we also find the free-energy difference between the singular values $\theta_{1} = 0$ and $\theta_{1} = \pm\pi$ to be
%
\begin{equation}
  \mathscr{A}(\pm\pi) - \mathscr{A}(0) \sim -\beta^{-1}\log{Y^{1/2}} = \tfrac{1}{2}\beta^{-1}\ln\left|\frac{\lambda + 1}{\lambda - 1}\right|,
\end{equation}
%
which is a purely geometric quantity.
This is exactly what we expect based on how the marginal density scales at a singular value [Eq.~\eqref{eq:scaling}], which shows that the free-energy difference must be a purely geometric quantity if the singular states support the same number of self stresses $s$.
A comparison between the numerical results and asymptotic expressions in Eq.~\eqref{eq:4bar_free} shows excellent agreement for all values of $\theta_{1}$ (Fig.~\ref{fig:4bar_free}).

Clearly, the free-energy profiles have minima for values of $\theta_{1}$ close to $0$ or $\pm\pi$, corresponding to shape-space singularities.
But a more assiduous reader may have noticed that the free-energy curves actually have a double-well minima around $\theta_{1} = 0$ and $\theta_{1} = \pm\pi$.
Also, there is an assymetry in these curves---the free energies of the four-bar linkage for $\theta_{1}$ close to $0$ is lower than $\theta_{1}$ close to $\pm\pi$.
In the next two subsections, we will try to understand these two features.

\subsubsection*{Double-well structures}

To intuitively see why the free-energy landscape of the four-bar linkage has a double-well structure centered around the singular values, consider the projection of its total energy in the space of the angles $\theta_{1}$ and $\theta_{2}$.
The projected energy can be found by setting the lengths of all bars equal to their natural lengths except for bar~3--4, which we assume to have an energy $\phi(\ell) = \kappa(\ell^{2} - \bar{\ell}^{2})^{2}/(8\bar{\ell}^{2})$.
(The exact form of the energy is irrelevant as long as it has a minimum at $\ell = \bar{\ell}$.)
Writing $\ell$ in terms of the angles $\theta_{1}, \theta_{2}$ we get
%
\begin{equation}
  \phi(\theta_{1}, \theta_{2}) = \frac{\kappa a^{2}}{8\lambda^{2}}\left[(\lambda + \cos\theta_{2} - \cos\theta_{1})^{2} + (\sin\theta_{2} - \sin\theta_{1})^{2} - \lambda^{2}\right]^{2}\,.
  \label{eq:energy34}
\end{equation}
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/4bar_energy34.pdf}
  \end{center}
  \caption{The level sets of the energy in Eq.~\eqref{eq:energy34} around $(\theta_{1}, \theta_{2}) = (0, 0)$ for $a = \kappa = 1$ and $\lambda = 2$.  The width of the energy sublevel sets is larger along small nonzero values of $\theta_{1}$ compared to $\theta_{1} = 0$ (e.g., $\delta' > \delta$).}
  \label{fig:energy34}
\end{figure}
%
Figure~\ref{fig:energy34} shows the level sets of $\phi(\theta_{1}, \theta_{2})$ near $(\theta_{1}, \theta_{2}) = (0, 0)$.
For $\abs{\theta_{1}} > 0$, there are two ground states in the \ac{cv} level set $\hat{\theta}_{1}^{-1}(\theta_{1})$, which is a straight line parallel to the $\theta_{2}$ axis in the $\theta_{1}$--$\theta_{2}$ space.
Because of the extra softness of the linkage near the singularity, this means that for small nonzero values of $\theta_{1}$, there are more thermodynamically favorable states in $\hat{\theta}_{1}^{-1}(\theta_{1})$ compared to $\hat{\theta}_{1}^{-1}(0)$, which is the \ac{cv} level set at the singular value $\theta_{1}=0$.
This is evidenced by the fact that for any given value $E > 0$, there are more points in the energy sublevel set $\left\{(\theta_{1}, \theta_{2}): \phi(\theta_{1}, \theta_{2}) \leq E\right\}$ along small nonzero values of $\theta_{1}$ than $\theta_{1} = 0$ (see Fig.~\ref{fig:energy34}).
The net increase in the number of thermodynamically favorable states near small nonzero values of $\theta_{1}$ lowers the free energy at those values, giving the landscape a double-well appearance.

We also remark that since an asymptotic expression for the free energy is available for the four-bar linkage, we can explicitly show the double-well nature of $\Delta\mathscr{A}(\theta_{1})$ and find locations of its minima.
For example, expanding Eq.~\eqref{eq:4bar_0} in $\theta_{1}$ around $\theta_{1} = 0$, we see that
%
\begin{equation}
  \Delta\mathscr{A}(\theta_{1}) \sim \left[1 + 8\pi^{2}\Gamma^{-4}\left(\tfrac{1}{4}\right)\right]X^{2}\theta_{1}^{4} - 4\pi\Gamma^{-2}\left(\tfrac{1}{4}\right)X\theta_{1}^{2},\label{eq:4barwell}
\end{equation}
%
which is the equation for a double well, with $\Gamma(\cdot)$ being the gamma function.
Expanding $\Delta\mathscr{A}(\theta_{1})$ to $\mathcal{O}(\abs{\theta_{1}}^{6})$ we see that the two double-well minima are approximately at\footnote{We expand $\Delta\mathscr{A}(\theta_{1})$ to $\mathcal{O}(\abs{\theta_{1}}^{6})$ instead of $\mathcal{O}(\abs{\theta_{1}}^{4})$ since there are higher-order corrections to Eq.~\eqref{eq:4barwell} that make an $\mathcal{O}(\abs{\theta_{1}}^{4})$ estimation less accurate.}
%
\begin{equation}
  \theta_{1}^{\text{min}} \approx \pm \sqrt{\frac{\Gamma^{2}\left(\tfrac{1}{4}\right)\left\{8\pi^{2} + \Gamma^{4}\left(\tfrac{1}{4}\right) - \sqrt{\left[8\pi^{2} + \Gamma^{4}\left(\tfrac{1}{4}\right)\right]^{2} - (16\pi^{2})^{2}}\right\}}{64\pi^{3}X}}.
  \label{eq:thetamin}
\end{equation}
%
Since $X \sim \sqrt{\beta}$, this also shows that as $\beta$ increases, $\theta_{1}^{\text{min}}$ shifts closer to $0$.

\subsubsection*{Asymmetries in the free-energy landscape}

We will now try to understand the origin of the asymmetry in the four-bar linkage's free-energy profile, i.e., the reason why the free-energy values close to $\theta_{1} = \pm \pi$ are higher than the values at $\theta_{1} = 0$.
Consider Fig.~\ref{fig:4bar_asymmetry} where we show a four-bar linkage in four different configurations, with the configurations on the left having an internal angle $\theta_{1}$ equal to the supplement of the value of $\theta_{1}$ for the configurations on the right.
Geometrically, one might have expected the configurations on the left to be mirror images of the ones on the right.
However, as Fig.~\ref{fig:4bar_asymmetry} shows, that is only true when the linkage is being deformed along the parallel branch and when it is on twisted branch, the two configurations are not mirror images.
This is what leads to an asymmetric free-energy landscape for the four-bar linkage.
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/4bar_asymmetry.pdf}
  \end{center}
  \caption{%
    For values of the angle $\theta_{1} \to 0 \text{ or } \pi$, the configurations of the four-bar linkage display a certain asymmetry depending on the branch they are in.
    In case of the parallel branch, the two configurations are mirror images of each other (top figures).
    On the twisted branch, however, the two configurations are asymmetric and cannot be rotated/reflected into one another (bottom figures).
    The angle $\theta_{1}$ for the two configurations on the left is equal to the supplement of the same angle for the configurations on the right.
  }
  \label{fig:4bar_asymmetry}
\end{figure}
%
\begin{figure}[b]
  \begin{center}
    \includegraphics{frameworks/4bar_free_theta2.pdf}
  \end{center}
  \caption{Free-energy difference $\Delta\mathscr{A}(\theta_2)$ of a four-bar linkage with parameters $a=1$ and $\lambda=2$ as a function of the angle $\theta_{2}$ [cf.~Fig.~\ref{fig:4bar_free}].
  The free energy is in units of $\beta^{-1}$ at $\beta = 10^{4}$.
  The inset shows the absolute errors between the numerical and asymptotic results.
  \label{fig:4bar_q2}
}
\end{figure}


%
A more quantitative evidence for this asymmetry can be seen by expanding the angle relations along the twisted branch, Eq.~\eqref{eq:twisted}, in $\theta_{1}$ around $\theta_{1} = 0$ and $\theta_{1} = \pm\pi$, whereby we find
%
\begin{equation}
  \begin{alignedat}{2}
    \theta_{2} &= \left(\frac{1+\lambda}{1-\lambda}\right)\theta_{1} + \mathcal{O}(\theta_{1}^{2}) && \qquad\text{(expansion around $\theta_{1} = 0)$},\\
    \pm\pi - \theta_{2} &= \left(\frac{1-\lambda}{1+\lambda}\right)\left(\pm\pi - \theta_{1}\right) + \mathcal{O}(\theta_{1}^{2}) && \qquad\text{(expansion around $\theta_{1} = \pm \pi$)}.
  \end{alignedat}
\end{equation}

The asymmetry in the free-energy profiles can also be seen if we use the angle $\theta_{2}$ as our \ac{cv} instead of the angle $\theta_{1}$.
Figure~\ref{fig:4bar_q2} shows the numerical free-energy profile as a function of the angle $\theta_{2}$, along with asymptotic results.
Again, there is impressive agreement between the numerical and asymptotic results.
However, now the free-energy for $\theta_{2}$ values close to $\theta_{2} = 0$ are smaller than the values close to $\theta_{2} = \pm\pi$.
The asymptotic expressions for the free energy used in Fig.~\ref{fig:4bar_q2} have been obtained using the general procedure outlined in this section.
But we do not write down the results explicitly as they can be read off from Eq.~\eqref{eq:4bar_free} after setting the nondimensional parameters $X \to \sqrt{\beta\kappa}\lambda a/(8\abs{\lambda+1})$ and $Y \to \left|(\lambda+1)/(\lambda-1)\right|$ [cf.~Eq.~\eqref{eq:XandY}].



\section{Example: triangulated origami}
\label{sec:origami}

For further testing our methods, we consider an origami made by triangulating a unit square~\cite{chen2018} and embedded in three dimensions [Fig.~\ref{fig:origami_free}(a)].
To make the origami more realistic, in simulations, we avoid all configurations that result in face intersections.
The one-dimensional shape space of this origami can be visualized as four intersecting branches in the space of the fold angles, i.e., the supplement of the dihedral angle at a fold.
The intersection point is the singular flat state of the origami, where all the fold angles are zero.

\subsection{Body frame}

To remove the rigid motions, we transform to a body frame attached to the origami with joint~1 at the origin, bar~1--2 lying along the $x$ axis, and bar~2--6 constrained to move on the $xy$ plane [see Fig.~\ref{fig:origami}].
The origami is made out of $N = 6$ joints and $m = 11$ bars and its configuration vector $\bm{q} \in \mathbb{R}^{12}$ in the body frame is $\bm{q} = (q_{1}, q_{2}, \ldots, q_{12})$.
All orientations of the origami in the lab frame can be fully described by the two spherical polar angles that uniquely give the orientation of bar~1--2 and an azimuthal angle that gives the overall rotation of the origami about bar~1--2~\cite{herschbach1959}.
After integrating over the coordinates of joint~1 (i.e., the translational coordinates) and the three angles, and dropping constant factors, the overall Jacobian factor involved in the transformation from the lab to the body frame is $I(\bm{q}) = \abs{q_1^2 q_{12}}$.
%
\begin{figure*}
  \begin{center}
    \includegraphics{frameworks/origami_free_old.pdf}
  \end{center}
  \caption{(a) A triangulated origami modeled as a bar-joint framework and (b) its shape space visualized in the space of fold angles $\rho_{1}, \rho_{2}$, and $\rho_{3}$.
    (c) Free-energy difference $\Delta\mathscr{A}(\rho_{1})$ in units of $\beta^{-1}$ at $\beta = 10^{4}$.
  The inset shows the absolute errors between the numerical and asymptotic results using the harmonic and quartic approximations (blue and red curves, respectively).}
  \label{fig:origami_free}
\end{figure*}

\subsection{Branch parameterization}

Since the shape space of the origami (and other larger frameworks) is not amenable to analytical parameterization, we have to parameterize it numerically.
We shall parameterize the branches of the shape space in terms of the fold angle $\rho_{1}$, which we will also use as our \ac{cv}.
We first express the tangent to the shape space at the flat state, $\bm{t}_{0} \in \ker \mathsf{C}$, in terms of its unknown components in the basis of the $(N - 3)$ out-of-plane displacement vectors of the joints.\footnote{Note that three of the $N$ joints are always constrained to move on a coordinate plane of the local Cartesian body frame.  This means that only $(N - 3)$ joints have out-of-plane displacements, and it is these displacement vectors that span $\ker\mathsf{C}$.}
An origami made by triangulating a square and having $N$ joints is expected to have at least $(N - 4)$ states of self stress $\bm{\sigma} \in \ker\mathsf{C}\trans$ when it is flat~\cite{chen2018}.
To find the components of $\bm{t}_{0}$, we then solve the $(N - 4)$ coupled quadratic equations~\cite{tarnai2001,chen2018} [see Eq.~\eqref{eq:tangentcone}]
%
\begin{equation}
  \bm{\sigma}\cdot\bm{w}(\bm{t}_{0}) = 0,\quad \text{for } \bm{\sigma} \in \ker{\mathsf{C}\trans}
  \label{eq:quadratic}
\end{equation}
%
along with the normalization condition $\Abs{\bm{t}_{0}} = 1$.
Here the $i$th component of the vector $\bm{w}(\bm{t}_{0}) \in \mathbb{R}^{m}$ is $\tfrac{1}{2}\bm{t}_{0}\trans \hess f_{i} \bm{t}_{0}$. 
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/origami.pdf}
  \end{center}
  \caption{(a) A triangulated origami as a bar-joint framework illustrating the coordinates of the joints in the body frame. When the origami is flat, the external vertices lie on the corners of a unit square and the internal vertices 5 and 6 have coordinates $(1/4,1/2,0)$ and $(3/4,1/2,0)$. (b) Finding the \ac{cv} (i.e., fold angle $\rho_{1}$) using simple geometry.}
  \label{fig:origami}
\end{figure}


Numerical evidence~\cite{chen2018} suggests that one would get $2^{N-4}$ unique tangent vectors---each corresponding to a particular branch---by solving the above quadratic equations.
(Also see the related discussion regarding the solution space of these equations in Section~\ref{sec:convergence}.)
Once a tangent vector to a branch at the flat state is selected, the rest of the branch can be parameterized by numerically solving the differential equation $\dd\bm{q}/\dd{h} = \bm{t}$, where $h$ is the arc length along a branch and $\bm{t}$ is the unit tangent vector to the branch at $\bm{q}$.
If the $k$th point on the branch is $\bm{q}_k \in \mathbb{R}^{n}$, the next point $\bm{q}_{k+1}$ is then found by solving $f(\bm{q}_{k+1}) = 0$, e.g., using the Gauss--Newton method.
As the initial guess we take $\bm{q}_{k+1} = \bm{q}_{k} + \Delta h\,\bm{t}_{k}$, where $\Delta h$ is the step length along a branch.
The tangent vector $\bm{t}_k$ for $k \ne 0$ can be found by numerically computing $\ker\mathsf{C}$ at $\bm{q}_k$.
Since the tangent vectors obtained this way does not preserve direction in general, we should also multiply each $\bm{t}_k$ that is found with the sign of its dot product with the previous tangent vector $\bm{t}_{k-1}$.

On successive repetition of the above steps starting at the flat state $(\bm{q}_0, \bm{t}_0)$, we get $\bm{q}$ as a function of the arc length $h$.
To reparameterize the branch using the \ac{cv}, which is the fold angle $\rho_{1}$ of fold 5--6, we first (linearly) interpolate between the arc-length parameterized points to obtain a set of points that are uniformly spaced in $\rho_{1}$.
We then refine the interpolated points by solving $f(\bm{q}) = 0$ with the interpolated points as the initial guess.
The interpolation/refinement steps can be repeated as many times as required to achieve the desired accuracy goal.
Once the parameterization is complete, the induced metric along a branch can be computed by approximating the derivatives using difference quotients.
Note that this parameterization is only used in conjunction with Eq.~\eqref{eq:mpd_regular}, the asymptotic expression  for the marginal density under the harmonic approximation.

\subsection{Marginal probability densities}

\subsubsection*{Regular values}

Similar to the calculation for the four-bar linkage, we first write down the constraint map $f: \mathbb{R}^{12} \to \mathbb{R}^{11}$ in the body frame and find the compatibility matrix $\mathsf{C} = \nabla f$.
Once all four branches of the shape space have been numerically parameterized in terms of the \ac{cv} $\rho_{1}$, the marginal probability density $\mathscr{P}(\rho_{1})$ can be computed using Eq.~\eqref{eq:mpd_regular}.
Here we remark that instead of computing $\det\,\mathsf{D}^{\perp}$ by finding the nonzero eigenvalues of $\mathsf{D}$, it is more convenient to calculate it using the fact that $\det\,\mathsf{D}^{\perp} = \det\,\mathsf{K}\mathsf{C}\mathsf{C}\trans$ at regular points.
This gives $\mathscr{P}(\rho_{1})$ for all $\rho_{1}$ far from the singular value (i.e., for $\abs{\rho_{1}} \gg 0$).

\subsubsection*{Singular value}

Our goal here is to use Eq.~\eqref{eq:mpd_singular} to find the marginal density $\mathscr{P}(\rho_{1})$ as $\rho_{1} \to 0$.
Since the calculation is similar in spirit to the case of the four-bar linkage, we only present the key steps here.
As before, we numerically compute $\det\,\mathsf{D}^{\perp}$ from the nonzero eigenvalues of $\mathsf{D}$ at the singularity.
The next step is to linearize the \ac{cv} map so that the integral in Eq.~\eqref{eq:mpd_singular} can be evaluated.

One can always numerically compute the fold angle $\rho_{1}$ as the angle between the normals to the faces that share fold 5--6.
However, for linearizing the \ac{cv} map, we need to find an expression that is more tractable analytically.
A moment's thought [and Fig.~\ref{fig:origami}(b)] shows that the \ac{cv} map can be written\footnote{To assign a sign to the fold angle, we first choose a unique normal to face 1--5--6 such that it coincides with the positive $z$ axis when the origami is flat.
Signs are then chosen so that a mountain fold (as perceived by looking downwards along this normal) has a positive fold angle, e.g., the angle in Fig.~\ref{fig:origami}(b) is negative since the fold is a valley fold.
} as $\hat{\rho}_{1}(\bm{q}) = -\tan^{-1}[d_{1}(\bm{q})/d_{2}(\bm{q})]$.
Here $d_{1}(\bm{q})$ is the perpendicular distance from joint~3 to the plane containing face 1--5--6, and $d_{2}(\bm{q})$ is the perpendicular distance from the projection of joint~3 on this plane to the line along fold 5--6.
A straightforward calculation gives
\begin{equation}
  d_{1}(\bm{q}) = \frac{q_{10}(q_{2}q_{12} - q_{3}q_{11}) + q_4(q_{9}q_{11} - q_{8}q_{12})}{\left|q_{10}^2 q_{11}^2+q_{10}^2 q_{12}^2+(q_9 q_{11}-q_8 q_{12})^2\right|^{1/2}}.
  %
\end{equation}
%
At the singular flat state $\bar{\bm{q}}^{*}$, we have $d_{1}(\bar{\bm{q}}^{*}) = 0$ and $d_{2}(\bar{\bm{q}}^{*}) = 0.5$, using which we find the Jacobian of the \ac{cv} map to be  \setcounter{MaxMatrixCols}{20}
\begin{equation}
  \begin{aligned}
    \nabla\hat{\rho}_{1}(\bar{\bm{q}}^{*}) = -\frac{d_{2}(\bar{\bm{q}}^{*})\nabla d_{1}(\bar{\bm{q}}^{*}) - d_{1}(\bar{\bm{q}}^{*})\nabla d_{2}(\bar{\bm{q}}^{*})}{d^{2}_{1}(\bar{\bm{q}}^{*}) + d^{2}_{2}(\bar{\bm{q}}^{*})} & = -\frac{\nabla d_{1}(\bar{\bm{q}}^{*})}{d_{2}(\bar{\bm{q}}^{*})} \\  & = \inmat{0 & 0 & 0 & -2 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0}.
       %
  \end{aligned}
\end{equation}
%
Here we see that one can linearize the \ac{cv} map without needing an explicit expression for $d_{2}(\bm{q})$.
Also, it is easy to verify that $(\nabla\hat{\rho}_{1})\bm{v} = 0$ for all fast modes $\bm{v} \in (\ker\mathsf{C})^{\perp}$, enabling us to use Eq.~\eqref{eq:mpd_singular} to find the marginal density as $\rho_{1} \to 0$.

As the basis for $\ker\mathsf{C}$ we choose the out-of-plane displacements of the joints in the body frame and write the vector $\bm{u} \in \ker \mathsf{C}$ in terms of the $z$ coordinates $q_{4}$, $q_{7}$, and $q_{10}$ of the joints.
This yields $\nabla\hat{\rho}_{1}\cdot\bm{u} = 2(q_{10} - q_{4})$.
It also follows that the hyperplane $\Xi_{\xi}$ is the plane defined by $2(q_{10} - q_{4}) = \rho_{1}$ in the $q_{4}$-$q_{7}$-$q_{10}$ space and we can parameterize the points on $\Xi_{\xi}$ using either $(q_{4}, q_{7})$ or $(q_{7}, q_{10})$.
Once we write down the vector $\bm{w}(\bm{u})$ and find the self stresses $\bm{\sigma}$, we have all the ingredients to use Eq.~\eqref{eq:mpd_singular}.
However, the integral that one is left with is not amenable to analytical integration, and so we have to resort to numerical quadrature.
We do this by using a simple Monte Carlo integration scheme with $10^{9}$ sample points for each value of $\rho_{1}$ so that the maximum error is below $10^{-3}$.
One also gets near-identical results with Mathematica's numerical integrator using a global adaptive method.\footnote{\url{https:/reference.wolfram.com/language/ref/NIntegrate.html}}

\subsection{Free energy}

The free-energy difference $\Delta\mathscr{A}(\rho_{1}) = \mathscr{A}(\rho_{1}) - \mathscr{A}(0)$ for all values of $\rho_{1}$ can be easily computed from the corresponding probability densities using Eq.~\eqref{eq:free_energy}.
As we see from Fig.~\ref{fig:origami_free}(b), the numerical and the asymptotic results for the free-energy difference $\Delta\mathscr{A}(\rho_{1})$ show good agreement in both regimes of $\rho_{1}$.
Self-avoidance of the faces forces us to consider only a part of each branch of the shape space for our analysis.
Since the extent of these parts (in $\rho_{1}$) vary for the four branches [Fig.~\ref{fig:origami_free}(a)], it results in discontinuous jumps in the free-energy curves.
Similar to the four-bar linkage, the free energy of the origami also has a double-well appearance around the singular value $\rho_{1} = 0$.
This is again because of the branched nature of its shape space and the increased softness near the singularity.

\section{Example: planar five-bar linkage}
\label{sec:5bar}

The example frameworks we have considered so far have one-dimensional shape spaces.
In this section, we illustrate the application of our formalism to a framework with a two-dimensional shape space, namely the planar five-bar linkage~\cite{mermoud2000,curtis2007} illustrated in Fig.~\ref{fig:5bar}(a).
The five-bar linkage we consider is made out of four bars of equal length $a$ and a fifth bar of length $2a$.
The shape space of the five-bar linkage [Fig.~\ref{fig:5bar}(b)] when visualized in the space of the angles $\zeta_{1}, \zeta_{2}$, and $\zeta_{3}$ appears as a two-dimensional surface with four isolated singularities,\footnote{At $(\zeta_{1}, \zeta_{2}, \zeta_{3}) = (0, 0, 0), (0, \pm\pi, \pm\pi), (\pm\pi, 0, \pm\pi), \text{ and } (\pm\pi, \pm\pi, 0)$.} all of which correspond to configurations where the bars become collinear and support a state of self stress.
Since force balance in self-stressed states of a planar polygonal linkage requires its bars to be collinear~\cite{farber2008}, it is not surprising that these singularities are isolated, and in their neighborhoods, the shape space is very nearly a double cone~\cite{kapovich1995,mermoud2000}.
Similar isolated singularities are also seen in the shape spaces of origami that have self-stressed flat states~\cite{berry2020}.
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/5bar.pdf}
  \end{center}
  \caption{(a) The five-bar linkage and (b) its shape space visualized in terms of the angles $\zeta_{1}, \zeta_{2},$ and $\zeta_{3}$.  These angles are measured counterclockwise from an axis parallel to bar~1--5.  Free-energy profile (in units of $\beta^{-1})$ at $\beta = 10^{4}$ around the singular value $\zeta^{*} = (0, 0)$ from (c) theory [Eq.~\eqref{eq:5bar}] and (d) simulations, with the dashed curves depicting the approximate bottom of the hyperbolic valley [Eq.~\eqref{eq:5barvalley}].}
  \label{fig:5bar}
\end{figure}


For the sake of brevity and to avoid cluttering this SM with qualitatively similar results, we only discuss the nature of the free-energy landscape around the singularity at $(\zeta_{1}, \zeta_{2}, \zeta_{3}) = (0, 0, 0)$.
Since the shape space of the five-bar linkage is two dimensional, we choose a similarly two-dimensional \ac{cv}, $\zeta = (\zeta_{1}, \zeta_{2})$.
Next, we employ Eq.~\eqref{eq:mpd_singular} to find the asymptotic free-energy difference $\Delta \mathscr{A}(\zeta)$, choosing the singular value $\zeta^{*} = (0,0)$ as the point of zero free energy.
Note that for doing this, we do not require an explicit parameterization of the linkage's shape space in terms of $\zeta$.  Such a parameterization is only required if we want to use Eq.~\eqref{eq:mpd_regular} to find the free energy far from $\zeta^{*} = (0, 0)$ using the harmonic approximation.
Since the other details are very similar to the previous calculations for the four-bar linkage and the triangulated origami, we just quote the final result:
%
\begin{equation}
  \Delta\mathscr{A}(\zeta) \sim \beta^{-1}\left\{Z^{2}\zeta_{1}^{2}\zeta_{2}^{2} - \ln\left[\frac{D_{-1/2}(-2Z\zeta_{1}\zeta_{2})}{D_{-1/2}(0)}\right]\right\},\label{eq:5bar}
\end{equation}
%
where $Z$ is a positive dimensionless term defined by $Z = \sqrt{\beta\kappa}a/(2\sqrt{5})$ [cf.~Eq.~\eqref{eq:4bar_0}].
A comparison between the theoretical and numerical results [Figs.~\ref{fig:5bar}(c) and \ref{fig:5bar}(d)] shows very good agreement between the two.
Similar to the four-bar linkage and the triangulated origami, the effective free energy minimum of the five-bar linkage is not at the singular value $\zeta^{*} = (0, 0)$.
Expanding $\Delta\mathscr{A}(\zeta)$ to $\mathcal{O}(\zeta_{1}^{3}\zeta_{2}^{3})$ around $\zeta^{*}$ we see that the bottom of the free-energy valley near the singular value [white dashed curves in Figs.~\ref{fig:5bar}(c) and \ref{fig:5bar}(d)] is approximately defined by the equation
%
\begin{equation}
  \zeta_{1}\zeta_{2} = \frac{\Gamma^{2}\left(\tfrac{1}{4}\right)\left\{8\pi^{2} + \Gamma^{4}\left(\tfrac{1}{4}\right) - \sqrt{\left[8\pi^{2} + \Gamma^{4}\left(\tfrac{1}{4}\right)\right]^{2} - (16\pi^{2})^{2}}\right\}}{64\pi^{3}Z},
  \label{eq:5barvalley}
\end{equation}
%
which is that of a rectangular hyperbola [cf.~Eq.~\eqref{eq:thetamin}].

\section{Permanently singular frameworks}
\label{sec:permanent}

Our discussion so far has been concerned with frameworks with isolated singularities.
In such frameworks, the constraint map $f$ drops rank only at the singularities and has full rank everywhere else.
Now consider the framework shown in Fig.~\ref{fig:trimer}(a).
The bars connecting joints~1, 2, and 3 of this framework are in a permanent state of self stress, irrespective of the value of the angle $\theta$.
By direct inspection we see that the one-dimensional shape space $\Sigma$ of this framework can be parameterized in terms of the internal angle $\theta$ using $\psi(\theta) = (a, \tfrac{1}{2}a, 0, a\cos{\theta}, a\sin{\theta})$.
This equation defines a smooth circle in $\mathbb{R}^{5}$, which does not have any ``visible'' singularities.
However, on inserting this parameterization into the compatibility matrix $\mathsf{C} = \nabla f$ and the dynamical matrix $\mathsf{D} = \mathsf{C}\trans\mathsf{K}\mathsf{C}$ we find (assuming that all bars have stiffness $\kappa$)
%
\begin{equation}
  \mathsf{C} =
  \begin{pmatrix}
    1 & 0 & 0 & 0 & 0 \\
    1 & -1 & 0 & 0 & 0 \\
    0 & 1 & 0 & 0 & 0 \\
    0 & 0 & 0 & \cos \theta & \sin \theta
  \end{pmatrix},
  \quad
  \mathsf{D} =
  \kappa
  \begin{pmatrix}
    2 & -1 & 0 & 0 & 0 \\
    -1 & 2 & 0 & 0 & 0 \\
    0 & 0 & 0 & 0 & 0 \\
    0 & 0 & 0 & \cos ^2\theta & \sin \theta  \cos \theta \\
    0 & 0 & 0 & \sin \theta \cos \theta & \sin ^2\theta
  \end{pmatrix}.
\end{equation}
%
Clearly, $\mathsf{C}$ is rank deficient irrespective of the value of $\theta$ and $\mathsf{D}$ has two zero modes: $\bm{t} = \dd\psi/\dd\theta \in T_{\bar{\bm{q}}}\Sigma$ corresponding to tangential motion on $\Sigma$ and a singular zero mode $\bm{u} = (0, 0, 1, 0, 0)$ associated with the self stress [see Fig.~\ref{fig:trimer}(a)].
Hence, even though the shape space here is a smooth manifold, the presence of the singular zero mode causes the harmonic approximation to break down everywhere on $\Sigma$.
This should be contrasted with the case of isolated singularities, where such singular modes appear only at the singularities of $\Sigma$.
The results that we have derived so far (namely, Eqs.~\ref{eq:mpd_regular} and \ref{eq:mpd_singular}) will not let us analyze permanently singular frameworks~\cite{muller2019,wu2020} such as the one in Fig.~\ref{fig:trimer}(a).
However, such frameworks have been considered in the context of colloidal clusters~\cite{kallus2017}.
It is thus instructive to rederive these results and compare them with our results for frameworks with isolated singularities.

Consider again a framework whose shape space $\Sigma$ is defined as the zero level set of a constraint map $f: \mathbb{R}^{n} \to \mathbb{R}^{m}$ with the compatibility matrix $\mathsf{C} = \nabla f$.
When there are $s$ permanent states of self stress, out of the $n - m + s$ zero modes that belong to $\ker\mathsf{C}$, there are $n-m$ zero modes that belong to the tangent space $T_{\bar{\bm{q}}}\Sigma$, and the remaining $s$ zero modes are the singular zero modes.
We can thus write $\ker\mathsf{C}(\bar{\bm{q}}) = T_{\bar{\bm{q}}}\Sigma \oplus \mathscr{S}$ for all $\bar{\bm{q}} \in \Sigma$.
Here $\mathscr{S}$ is the subspace of the singular zero modes at $\bar{\bm{q}}$, defined as the orthogonal complement of $T_{\bar{\bm{q}}}\Sigma$ in $\ker\mathsf{C}$.\footnote{Since the zero modes are degenerate, the singular zero modes obtained by computing $\ker\mathsf{C}$ (or $\ker\mathsf{D}$) need not be orthogonal to $T_{\bar{\bm{q}}}\Sigma$.  Hence, in writing $\ker\mathsf{C} = T_{\bar{\bm{q}}}\Sigma \oplus \mathscr{S}$, we are \emph{defining} a singular mode to be one that belongs to $\ker\mathsf{C}$, but is orthogonal to $T_{\bar{\bm{q}}}\Sigma$. Clearly, such zero modes cannot be extended to a smooth deformation of the framework.}
Note that such a decomposition of $\ker\mathsf{C}$ into two vector subspaces is not possible when $\Sigma$ has isolated singularities (where multiple branches cross) for two reasons: (i) singular zero modes exist only at the singularities of $\Sigma$ and (ii) at these singularities, there is no well-defined tangent space $T_{\bar{\bm{q}}}\Sigma$.
%
\begin{figure}
  \begin{center}
    \includegraphics{frameworks/trimer.pdf}
  \end{center}
  \caption{(a) A planar framework with four joints and four bars in a body frame attached to the framework.  A bar of length $a$ connects joints~1 and~2, and two other bars of length $\tfrac{1}{2}a$ connect joint~3 with joints~1 and~2, which results in a state of self stress between joints 1, 2, and 3~\cite{calladine1978} for all values of $\theta$. Here $\bm{t}$ is the zero mode corresponding to tangential motion on the shape space $\Sigma$, $\bm{u}$ is a singular zero mode associated with the self stress, and $\bm{v}$ is one of the three vibrational modes.  (b) Free-energy difference $\Delta\mathscr{A}(\theta)$ [Eq.~\eqref{eq:trimer_free}] in units of $\beta^{-1}$ for a hypothetical $\theta$-dependent stiffness $\kappa(\theta) = \kappa_{0}(1 + \cos^{2}{\theta})$, chosen to verifying scaling. For constant stiffness, $\Delta\mathscr{A}(\theta)$ is zero and the free-energy landscape is flat (unlike in the case of isolated singularities).}
  \label{fig:trimer}
\end{figure}

Since the subspace $\mathscr{S}$ of singular zero modes can be identified for all points in $\Sigma$, we can expand the energy to quartic order along $\bm{u} \in \mathscr{S}$ using Eq.~\eqref{eq:energy_singular}.
(This would not have been possible for isolated singularities since Eq.~\eqref{eq:energy_singular} is valid only when the expansion is around a singularity.)
To derive the asymptotic marginal density $\mathscr{P}(\theta)$, we can then proceed similar to the derivation of Eq.~\eqref{eq:mpd_regular}.
As before, we pick coordinates associated with the framework's internal degrees of freedom as our \ac{cv} $\xi$ and assume that $\Sigma$ can be parameterized using $\xi$.
We expand both the terms in the exponent of Eq.~\eqref{eq:prob_delta} around each ground state $\bar{\bm{q}} \in \hat{\xi}^{-1}(\xi)$ after setting $\bm{q} \to \bar{\bm{q}} + \bm{t} + \bm{u} + \bm{v}$, where $\bm{t} \in T_{\bar{\bm{q}}}\Sigma$ is a zero mode that can be extended to a smooth deformation of the framework, $\bm{u} \in \mathscr{S}$ is a singular zero mode, and $\bm{v} \in (\ker\mathsf{C})^{\perp}$ is a fast mode.
We also choose the columns of $\nabla\psi(\xi)$ as the basis for $T_{\bar{\bm{q}}}\Sigma$, with $\psi: \mathbb{R}^{n-m} \to \mathbb{R}^{n}$ being the parameterization of $\Sigma$ near $\bar{\bm{q}}$.
Integrating over the components of $\bm{t}$ yields
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(\xi) &\sim I(\xi)\left(\frac{2\pi}{\beta}\right)^{(m - s)/2} \left|\det\,[\nabla\psi(\xi)]\trans\nabla\psi(\xi)\right|^{1/2} \int_{\mathscr{S}} \dd\bm{u} \int_{(\ker\mathsf{C})^{\perp}} \dd\bm{v}\, \exp\left[-\tfrac{1}{2}\beta\kappa\Abs{\mathsf{C}\bm{v} + \bm{w}(\bm{u})}^{2}\right]\\
                                 &= I(\xi)\left(\frac{2\pi}{\beta}\right)^{(m - s)/2}(\beta\kappa)^{-s/4} \left|\frac{\det\,[\nabla\psi(\xi)]\trans\nabla\psi(\xi)}{\det\,\mathsf{D}^{\perp}(\xi)}\right|^{1/2} \int_{\mathbb{R}^{s}} \dd\bm{x}\, \exp\left\{-\tfrac{1}{2}\sum_{\bm{\sigma}}[\bm{\sigma}\cdot\bm{w}(\bm{x})]^{2}\right\}.
  \end{aligned}
  \label{eq:mpd_perm}
\end{equation}
%
In the last step, we have integrated over the fast modes in $(\ker\mathsf{C})^{\perp}$ and used the results in Eqs.~\eqref{eq:mpd_gaussian}--\eqref{eq:mpd_proj}, with $\det\mathsf{D}^{\perp}$ being the product of the $m-s$ nonzero eigenvalues of the dynamical matrix $\mathsf{D}$ at $\psi(\xi)$.
Also, after picking an orthonormal basis for $\mathscr{S}$ and writing $\bm{u} = \mathsf{A}\bm{x}$, we can rescale the components $\bm{x} \to (\beta\kappa)^{-1/4}\bm{x}$ to extract all $\beta$ and $\kappa$ dependence as the term $\sum_{\bm{\sigma}} [\bm{\sigma}\cdot \bm{w}(\bm{x})]^{2}$ is a homogeneous quartic polynomial in the components of $\bm{x}$.
Equation~\eqref{eq:mpd_perm} is a rederivation of the integrand in Eq.~(14) of Ref.~\cite{kallus2017} and although it looks very similar to Eq.~\eqref{eq:mpd_singular}, it is fundamentally different.
The similarities arise due to the fact that in deriving both Eqs.~\eqref{eq:mpd_perm} and \eqref{eq:mpd_singular}, we used the same quartic-order expansion of the energy.
Nonetheless, it is worthwhile to compare the two equations.
We can identify four major differences.

\paragraph{Integration domain.}
The integration domain in Eq.~\eqref{eq:mpd_perm} is $\mathscr{S}$, the subspace of singular zero modes, which exists for all configurations of a permanently singular framework.
In comparison, when the framework has isolated singularities, singular zero modes arise only at these singularities.
Furthermore, the domain of integration in Eq.~\eqref{eq:mpd_singular} is a \ac{cv}-dependent hyperplane $\Xi_{\xi} = (\nabla\hat{\xi})^{-1}(\xi - \xi^{*}) \cap \ker\mathsf{C}$, which is not the subspace of singular zero modes, and such a vector subspace cannot be identified for a framework with isolated singularities.

\paragraph{Relation to the shape space.}
Using Eq.~\eqref{eq:mpd_perm} requires a parameterization $\psi(\xi)$ of the shape-space $\Sigma$ and the factor $\det\,(\nabla\psi)\trans\nabla\psi$ is the determinant of the induced metric on $\Sigma$.
This is similar to Eq.~\eqref{eq:mpd_regular}, which is the harmonic marginal density.
In contrast, Eq.~\eqref{eq:mpd_singular} does not make an explicit reference to $\Sigma$ and does not involve any parameterization of its branches.
Equation~\eqref{eq:mpd_singular} acquires the factor $\abs{\det\,{\nabla\hat{\xi}}(\nabla\hat{\xi})\trans}^{-1}$ from Eq.~\eqref{eq:coarea}, which a corollary of the coarea formula.
Also, Eq.~\eqref{eq:mpd_perm} is valid for all values of $\xi$, whereas Eq.~\eqref{eq:mpd_singular} is only valid when $\xi$ is close to a singular value $\xi^{*}$ of the \ac{cv}.

\paragraph{Convergence.}
If a permanently singular framework becomes second-order rigid (see Section~\ref{sec:convergence}) once the zero modes are restricted to the subspace $\mathscr{S}$, then $\bm{\sigma}\cdot\bm{w}(\bm{x}) > 0$ for all $\bm{\sigma}$ and the integral in Eq.~\eqref{eq:mpd_perm} converges~\cite{kallus2017}.
In particular, it will not converge for frameworks that are rigid, but not second-order rigid in $\mathscr{S}$ (e.g., see the example in Appendix A.3 of Ref.~\cite{connelly1996}).
This should be contrasted with the case of Eq.~\eqref{eq:mpd_singular} where there would always be vectors $\bm{t}$ in the integration domain $\Xi_{\xi}$ that satisfy $\bm{\sigma}\cdot\bm{w}(\bm{t}) = 0$ (each corresponding to a tangent to the branch at the singularity).
Hence, convergence of Eq.~\eqref{eq:mpd_singular} relies on the requirement that the number of such vectors is finite. Two necessary conditions required for this are (i) the tangents $\bm{t}$ are resolvable at second order and (ii) the \ac{cv} map is such that $(\nabla\hat{\xi})\bm{t} \neq 0$ for all $\bm{t}$ (see Section~\ref{sec:convergence}).

\paragraph{Scaling.}
The scaling of Eq.~\eqref{eq:mpd_perm} with respect to $\beta$ is consistent with Eq.~(9) of Ref.~\cite{kallus2017}.
Furthermore, since the scaling is independent of the value of the \ac{cv} $\xi$, one would generically expect the free-energy barriers in a permanently singular framework to be dominated by entropic effects and the landscape would have the same appearance for all values of $\beta$ (provided it is large).
Contrast this with Eq.~\eqref{eq:mpd_singular}, where the term in the exponent is an inhomogeneous quartic polynomial in the components of $\bm{u}$ for $\xi \neq \xi^{*}$ (see Section~\ref{sec:scaling}).
This makes the scaling nontrivial and gives rise to temperature-dependent barriers in the free-energy landscape.

Returning to the example framework in Fig.~\ref{fig:trimer}(a), using Eq.~\eqref{eq:mpd_perm}, we find the marginal density $\mathscr{P}(\theta)$ and the free-energy difference $\Delta\mathscr{A}(\theta) = -\beta^{-1}\ln\mathscr{P}(\theta) + \beta^{-1}\ln\mathscr{P}(0)$ to be
%
\begin{equation}
  \mathscr{P}(\theta) = \Gamma\left(\tfrac{1}{4}\right)\left|\frac{2\pi^{6}a^{10}}{3(\beta\kappa)^{7}}\right|^{1/4},
  \quad
  \Delta\mathscr{A}(\theta) = \tfrac{7}{4}\beta^{-1}\ln\left[\frac{\kappa(\theta)}{\kappa(0)}\right].
  \label{eq:trimer_free}
\end{equation}
%
Above, we have allowed for a hypothetical $\theta$-dependent stiffness $\kappa(\theta)$ so that the scaling factor $7/4$ can be verified.
The numerical results in Fig.~\ref{fig:trimer}(b) show excellent agreement with the analytical predictions.
If the stiffness $\kappa$ is a constant, then $\Delta\mathscr{A}(\theta)$ vanishes for all values of $\theta$ and the landscape becomes flat.
This should be contrasted with the examples for frameworks with isolated singularities, where temperature-dependent free-energy barriers exist even for constant stiffness.


\section{Conclusion}

In this chapter we have described a formalism to find the free-energy landscapes of common bar-joint frameworks with isolated singularities in their shape spaces.
Our results indicate that configurations in the neighborhood of the singularities have relatively lower free energy compared to configurations farther from the singularities.
More specifically, the free-energy landscapes of the four-bar linkage and the triangulated origami [Figs.~\ref{fig:4bar_free} and \ref{fig:origami}(c)] demonstrate that the measured values of the \ac{cv} tend to be closer to their values near the singularities.
Yet, as free-energy landscapes (and even their extrema) do not always have a \ac{cv}-agnostic interpretation~\cite{e2004,hartmann2007,frenkel2013}, to draw conclusions we should also consider the physical meaning of the chosen \ac{cv} (see Appendix~\ref{sec:misc} for further discussion).
The \ac{cv}s we picked for both the example frameworks were internal angles whose values dictate the overall shape of the framework.
Specifically, according to our results, we expect the bars of the four-bar linkage to tend to be collinear, as measured by the angle $\theta_1$ being close to $0$ or $\pi$.
Similarly, the origami will tend towards being flat, as measured by the fold angle $\rho_1$.
This tendency increases at lower temperatures as the free-energy barriers become larger.

Our findings could help in programming the conformational dynamics of nanoframeworks~\cite{dunn2015} and highlight the interplay between the geometry of a framework's shape space and its thermodynamic properties.
Since changes in configuration space topology is known to drive equilibrium phase transitions in certain physical systems~\cite{kastner2008}, it would then be interesting to consider how shape-space singularities affect the physical properties of frameworks in the thermodynamic limit.
Indeed, the affinity for the origami to be in nearly-flat configurations is reminiscent of the well-known flat phase of a polymerized membrane~\cite{abraham1990,bowick1996}, which is the natural thermodynamic limit of the triangulated origami.
Additionally, it would be interesting to explore the connection between recent mean-field theories~\cite{hernandez2022} written to describe the anomalous elastic response of cellular tissues and the results presented in this work.
The onset of rigidity in these tissues can be mapped to a critical configuration in a single cell's configuration space, rather similar to the singularities we have seen so far.\footnote{Compare, for instance, Fig.~4 of Ref.~\cite{hernandez2022} and Fig.~\ref{fig:confspaces}(c) on page~\pageref{fig:confspaces}.}
Other open questions include the behavior of these frameworks in the presence of active (nonthermal) noise~\cite{gandikota2023,gandikota2023a}, which is known to preferentially actuate zero modes~\cite{woodhouse2018}, and methods to bias their dynamics towards desired states~\cite{kang2019}, e.g., by introducing \ac{cv}-dependent bias potentials~\cite{kastner2011}.

\begin{subappendices}

\section{Numerical simulations}
\label{sec:numerics}

For all the frameworks we consider in this chapter, we perform our numerical simulations%
\footnote{The code we use for Monte Carlo simulations and numerical parameterization of the shape spaces is publicly available at \url{https:/github.com/manu-mannattil/thermmech}.}
in the lab frame at an inverse temperature $\beta = 10^{4}$ using a central-force potential $\phi_i[\ell_i(\bm{r})] = [\ell_i^{2}(\bm{r}) - \bar{\ell}_i^2]^2/(8\bar{\ell}_i^2)$, which has an absolute minimum at $\ell_i = \bar{\ell}_i$, for $\ell_i \geq 0$.
With this potential, the stiffness $\kappa_{i} = \phi_i''(\bar{\ell}_i) = 1$ for all bars.
Alternatively, any other potential $\phi_{i}(\ell_{i})$ that depends only on the bar lengths and having a minimum at $\ell_{i} = \bar{\ell}_{i}$ can be used.
We find the marginal probability densities of the \ac{cv} [Eq.~\eqref{eq:mpd}] using histograms obtained from sampling the Boltzmann--Gibbs distribution using the classical Metropolis Monte Carlo algorithm (with an acceptance rate of about 50\% and $\sim 10^{9}$ samples).
The free-energy profile is then found using Eq.~\eqref{eq:free_energy}.
For the triangulated origami, there is an additional need to reject all Monte Carlo moves that lead to face crossings:
%
\begin{enumerate}
  \item For faces that share an edge [e.g., faces 1--2--6 and 2--3--6 in Fig.~\ref{fig:origami}(a)], a face crossing can be detected by looking for sign changes in the fold angle of the shared fold when it is close to $\pm \pi$.
  \item For faces that do not share an edge, we use a triangle-triangle intersection test~\cite{tropp2006} to check if they intersect.
    Since there are eight such face pairs, to reduce computational costs, we only check this when the origami is sufficiently folded.
\end{enumerate}

\section{Miscellaneous remarks}
\label{sec:misc}

In this appendix, we collect some remarks regarding general free-energy landscapes and their interpretation.

\subsection{Free energy under CV diffeomorphisms}

The first issue we want to address is the lack of invariance of the free energy under a diffeomorphism (a differentiable transformation with a differentiable inverse) of the \ac{cv}.
Consider an $l$-dimensional \ac{cv} $\xi \in \mathbb{R}^{l}$, measurable with a \ac{cv} map $\hat{\xi}: \mathbb{R}^{n} \to \mathbb{R}^{l}$.
Let $h: \mathbb{R}^{l} \to \mathbb{R}^{l}$ be a diffeomorphism such that $h(\xi) = \zeta$.
The \ac{cv} map for $\zeta$ is $\hat{\zeta} = h \circ \hat{\xi}$.
On putting this in the coarea formula, Eq.~\eqref{eq:coarea}, we find the new marginal denisty $\mathscr{P}(\zeta)$ to be
%
\begin{equation}
  \mathscr{P}(\zeta) = \int_{\zeta^{-1}(\zeta)} \frac{\dd{\Theta}\,(\bm{q})}{\abs{\det\, \nabla \hat{\zeta}(\nabla \hat{\zeta})\trans}^{1/2}} \exp\left[-\beta U(\bm{q})\right].
\end{equation}
%
The \ac{cv} level set $\hat{\xi}^{-1}(\xi)$ is identical to $\hat{\zeta}^{-1}(\zeta)$.
To see this, note that for every point $\bm{q} \in \hat{\xi}^{-1}(\xi)$, we have $\hat{\zeta}(\bm{q}) = h(\hat{\xi}(\bm{q})) = h(\xi) = \zeta$, showing that $\bm{q} \in \hat{\zeta}^{-1}(\zeta)$ as well.
Next, we use $\hat{\zeta} = h\circ\hat{\xi}$, to find $\nabla \hat{\zeta} = \nabla h\,\nabla \hat{\xi}$, so that $\det\, \nabla\hat{\zeta}(\nabla\hat{\zeta})\trans = \det\, \nabla\hat{\xi}(\nabla\hat{\xi})\trans\det\,(\nabla h)\trans\nabla h$.
Using this in $\mathscr{P}(\zeta)$, we find
%
\begin{equation}
  \mathscr{P}(\zeta) = \mathscr{P}(\xi)\,\abs{\det\,{(\nabla h)\trans \nabla h}}^{-1/2},
\end{equation}
%
so that the free energy in the new variable $\zeta$ is
%
\begin{equation}
  \mathscr{A}(\zeta) = \mathscr{A}(\xi) + \tfrac{1}{2}\beta^{-1}\log\,\abs{\det\,{(\nabla h)\trans \nabla h}}.
  \label{eq:cvtrans}
\end{equation}

As the \ac{cv} level sets $\hat{\xi}^{-1}(\xi)$ and $\hat{\zeta}^{-1}(\zeta)$ are identical, physically speaking, when working with both $\zeta$ and $\xi$, we are restricting our attention to the same set of microstates.
Hence, the free energies $\mathscr{A}(\zeta)$ and $\mathscr{A}(\xi)$ not being equal is a bit perplexing.
In reality, it is a simple consequence of probability density functions acquiring a Jacobian factor under a coordinate transformation.
Because of the additional logarithmic term in Eq.~\eqref{eq:cvtrans} (often called a gauge term~\cite{hartmann2011}) the functional forms of $\mathscr{A}(\xi)$ and $\mathscr{A}(\zeta)$ can be completely different.
Consequently, $\mathscr{A}(\xi)$ may have an entirely different set of extremas compared to $\mathscr{A}(\zeta)$ and for this reason, interpreting free-energy landscapes require careful consideration of the \ac{cv} used to describe them.

\subsection{Choice of CV and free-energy extrema}

This is best illustrated with an example.
Consider a rotor of unit natural length in two dimensions centered around the origin with a rotationally symmetric potential energy%
\footnote{We could have also chosen the more conventional energy function $U(x, y) = \kappa(\smash[b]{\sqrt{x^2 + y^2}} - 1)^2$, but that makes the integrals that follow difficult to evaluate exactly.}
$U(x, y) = \tfrac{1}{2}\kappa(x^2 + y^2 - 1)^2$, with $\kappa$ being a ``spring constant'' to set the units [see Fig.~\ref{fig:rotor}(b)].
This potential energy function achieves its minimum on the unit circle $\Omega$ defined by $x^2 + y^2 = 1$, which we treat as the ``configuration space'' $\Omega$ of the rotor.
If we choose the $x$ coordinate of the rotor as our \ac{cv}, the \ac{cv} map is $\hat{x}: (x,y) \mapsto x$.
The marginal density $\mathscr{P}(x)$ of the \ac{cv} is then
%
\begin{equation}
  \begin{aligned}
    \mathscr{P}(x) &= \int_{-\infty}^{\infty} \dd{y}\, \exp\left[-\tfrac{1}{2}\beta\kappa(x^2 + y^2 - 1)^2\right]\\
                             &= (\beta\kappa)^{-1/4}\exp\left[-\tfrac{1}{2}\beta\kappa(x^2 - 1)^2\right]\,\int_{0}^{\infty} \dd{t}\,t^{-1/2}\exp\left[-\tfrac{1}{2}t^2 - \sqrt{\beta\kappa}(x^2 - 1)t\right]\\
                             &= \sqrt{\pi}(\beta\kappa)^{-1/4}\exp\left[-\tfrac{1}{4}\beta\kappa(x^2 - 1)^2\right]D_{-1/2}\left[\sqrt{\beta\kappa}(x^2 - 1)\right]\,,
                             \label{eq:rotor_pdf}
  \end{aligned}
\end{equation}
%
where $D_{-1/2}[\,\cdot\,]$ is the parabolic cylinder function%
\footnote{We can also write $\mathscr{P}(x)$ in terms of the modified Bessel function of the second kind $K_{1/4}(\,\cdot\,)$ after making use of the relation $D_{-1/2}(z) = \sqrt{z/(2\pi)}K_{1/4}(z^2/4)$ \cite[Eq.~12.7.10]{olver2010}.
This is the result that computer-algebra systems often produce.} \cite[Eq.~12.5.1]{olver2010}.
Using the above expression for $\mathscr{P}(x)$, and choosing $x=0$ as the point of zero free energy, we find the free-energy difference to be
\begin{equation}
\begin{aligned}\label{eq:rotor_exact_a}
  \mathscr{A}(x) - \mathscr{A}(0) &= -\beta^{-1}\log{\mathscr{P}(x)} +\beta^{-1}\log{\mathscr{P}(0)}\\
                                                      &= \tfrac{1}{4}\kappa(x^4 - 2x^2) - \beta^{-1}\log\left\{\frac{D_{-1/2}\left[\sqrt{\beta\kappa}(x^2-1)\right]}{D_{-1/2}\left(-\sqrt{\beta\kappa}\right)}\right\}\,.
\end{aligned}
\end{equation}
%
This is an exact expression for the free-energy difference, represented by the black curve in Fig.~\ref{fig:rotor}(a).
It is not readily obvious why a rotor with a rotationally symmetric potential would have a free-energy landscape that is not flat, particularly when it is clear that the rotor samples all orientations uniformly.
To make things even more confusing, from Fig.~\ref{fig:rotor}(a), one might even think that the rotor spends more time near $x=\pm 1$ compared to other points.
But this is misleading.
The only thing we can say from the rotor's free-energy landscape is that measured values of its $x$ coordinate have a propensity to be close to $x=\pm 1$.
Indeed, a much better \ac{cv} for the thermalized rotor would be the polar angle $\hat{\theta} = \tan^{-1}(y/x)$.
With this \ac{cv}, we would find that $\mathscr{P}(\theta)$ is a constant, resulting in a flat free-energy landscape.
%
\begin{figure}
  \begin{center}
    \includegraphics{fluctuations/rotor.pdf}
  \end{center}
  \caption{
    (a) Free-energy $\Delta \mathscr{A}(x)$ of a stiff rotor at inverse temperature $\beta = 100$, from the exact expression [Eq.~\eqref{eq:rotor_exact_a}; red dashed line] and asymptotic expression [Eq.~\eqref{eq:rotor_asy_a}; blue dashed line].
    Note how the asymptotic expression has a logarithmic divergence at $x = \pm 1$.
    Also note that the free-energy minimum is \emph{not} at $x = \pm 1$ as one might guess (or how the asymptotic expression suggests).
    (b) Configuration space $\Omega$ of the rotor and the \ac{cv} level set $\hat{x}^{-1}(x)$ have a nontransversal intersection at $x = 1$.
  }
  \label{fig:rotor}
\end{figure}

A similar issue arises when one evaluates the integral in Eq.~\eqref{eq:rotor_pdf} asymptotically for large $\beta$ using the harmonic approximation, Eq.~\eqref{eq:mpd_regular}.
To do that, we need to parameterize $\Omega$ in terms of the coordinate $x$ and compute the nonzero eigenvalues of the dynamical matrix along $\Omega$.
Two (standard) parameterizations in $x$ that cover a unit circle are
%
\begin{equation}
  \psi_{\pm}(x) = \left(x, \pm\sqrt{1 - x^2}\right).
\end{equation}
%
The determinant of the corresponding induced metrics is
%
\begin{equation}
  |\det\, (\nabla\psi_{\pm})\trans \nabla\psi_{\pm}| = \left(1-x^2\right)^{-1}.
\end{equation}
%
Meanwhile, the dynamical matrix is
%
\begin{equation}
  \mathsf{D} = \hess U(x, \pm\sqrt{1-x^2}) = 4\kappa
  \begin{pmatrix}
    x^2 & \pm x\sqrt{1-x^2}\\
    \pm x\sqrt{1-x^2} & 1-x^2
  \end{pmatrix}\,,
\end{equation}
%
which has only one nonzero eigenvalue, $4\kappa$.
Making use of Eq.~\eqref{eq:mpd_regular}, in the large-$\beta$ limit, we get the asymptotic marginal density%
\footnote{Here we have added contributions from both $\psi_{+}$ and $\psi_{-}$.}
%
\begin{equation}
  \mathscr{P}(x) \sim \sqrt{\frac{2\pi}{\beta\kappa(1-x^2)}}.
\end{equation}
%
Aside from normalization factors, $\mathscr{P}(x)$ above is the probability density of $x$ coordinates of points sampled uniformly (e.g., with respect to the polar angle) on a unit circle.
This leads to a free-energy difference of the form
%
\begin{equation}\label{eq:rotor_asy_a}
  \mathscr{A}(x) - \mathscr{A}(0) \sim \beta^{-1}\log\sqrt{1-x^2}\,.
\end{equation}
%
This free energy has a logarithmic divergence as $x \to \pm 1$.
This can be traced back to the coordinate singularity~\cite{liu2003} at $x = \pm 1$ when we parameterize a circle using $x$.
Geometrically, as we show in the cartoon in Fig.~\ref{fig:rotor}(b), this corresponds to a nontransversal intersection between the \ac{cv} level sets $\hat{x}^{-1}(\pm 1)$ and the configuration space $\Omega$.

\smallbreak
In summary, the above discussions on \ac{cv} diffeomorphisms and the example of the thermalized rotor shows that free-energy landscapes have to be carefully interpreted, taking into consideration the physical meaning of the chosen \ac{cv}.

\end{subappendices}
